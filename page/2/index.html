<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="Karen">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="Karen">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Karen">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/2/"/>





  <title>Karen</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Karen</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/22/博客中显示图片/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/22/博客中显示图片/" itemprop="url">博客中显示图片</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-22T15:09:46+08:00">
                2018-08-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li><p>把主页配置文件<code>_config.yml</code> 里的<code>post_asset_folder:</code>这个选项设置为<code>true</code></p>
</li>
<li><p>在你的hexo目录下执行这样一句话<code>npm install hexo-asset-image --save</code>，这是下载安装一个可以上传本地图片的插件，来自dalao：<a href="https://github.com/CodeFalling/hexo-asset-image" target="_blank" rel="noopener">dalao的git</a></p>
</li>
<li><p>等待一小段时间后，再运行<code>hexo n &quot;xxxx&quot;</code>来生成md博文时，<code>/source/_posts</code>文件夹内除了<code>xxxx.md</code>文件还有一个同名的文件夹</p>
</li>
<li><p>最后在<code>xxxx.md</code>中想引入图片时，先把图片复制到xxxx这个文件夹中，然后只需要在xxxx.md中按照markdown的格式引入图片：</p>
<p><code>![你想输入的替代文字](xxxx/图片名.jpg)</code></p>
<p><strong>注意：</strong> xxxx是这个md文件的名字，也是同名文件夹的名字。只需要有文件夹名字即可，不需要有什么绝对路径。你想引入的图片就只需要放入xxxx这个文件夹内就好了，很像引用相对路径。</p>
</li>
<li><p>最后检查一下，<code>hexo g</code>生成页面后，进入<code>public\2017\02\26\index.html</code>文件中查看相关字段，可以发现，html标签内的语句是<code>&lt;img src=&quot;2017/02/26/xxxx/图片名.jpg&quot;&gt;</code>，而不是<code>&lt;img src=&quot;xxxx/图片名.jpg&gt;</code>。这很重要，关乎你的网页是否可以真正加载你想插入的图片。</p>
</li>
</ol>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/22/数据分析————-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/22/数据分析————-3/" itemprop="url">数据分析———— 3</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-22T08:54:33+08:00">
                2018-08-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="数据加载、存储和文件格式"><a href="#数据加载、存储和文件格式" class="headerlink" title="数据加载、存储和文件格式"></a>数据加载、存储和文件格式</h4><p>%a 星期的简写。如 星期三为Web<br>%A 星期的全写。如 星期三为Wednesday<br>%b 月份的简写。如4月份为Apr<br>%B 月份的全写。如4月份为April<br>%c:  日期时间的字符串表示。（如： 04/07/10 10:43:39）<br>%d:  日在这个月中的天数（是这个月的第几天）<br>%f:  微秒（范围[0,999999]）<br>%H:  小时（24小时制，[0, 23]）<br>%I:  小时（12小时制，[0, 11]）<br>%j:  日在年中的天数 [001,366]（是当年的第几天）<br>%m:  月份（[01,12]）<br>%M:  分钟（[00,59]）<br>%p:  AM或者PM<br>%S:  秒（范围为[00,61]，为什么不是[00, 59]，参考python手册~_~）<br>%U:  周在当年的周数当年的第几周），星期天作为周的第一天<br>%w:  今天在这周的天数，范围为[0, 6]，6表示星期天<br>%W:  周在当年的周数（是当年的第几周），星期一作为周的第一天<br>%x:  日期字符串（如：04/07/10）<br>%X:  时间字符串（如：10:43:39）<br>%y:  2个数字表示的年份<br>%Y:  4个数字表示的年份<br>%z:  与utc时间的间隔 （如果是本地时间，返回空字符串）<br>%Z:  时区名称（如果是本地时间，返回空字符串）<br>%%:  %% =&gt; %</p>
<p>jira,禅道</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/20/数据分析——-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/20/数据分析——-1/" itemprop="url">数据分析—— 1</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-20T10:29:23+08:00">
                2018-08-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="数据分析是什么？"><a href="#数据分析是什么？" class="headerlink" title="数据分析是什么？"></a>数据分析是什么？</h3><p>  数据分析是基于商业目的，有目的的进行收集，整理，加工和分析数据，提炼有价信息的一个过程。</p>
<p>  分为明确分析目的与框架，数据收集，数据处理，包括数据清洗和转换，数据分析，数据展现和报告6个阶段。</p>
<p>以下我们先来热身一些专业名词，放在开头也很好查阅。</p>
<p>伪随机数</p>
<blockquote>
<p>伪随机数是用确定性的算法计算出来自[0,1]均匀分布的随机数序列。并不真正的随机，但具有类似于随机数的统计特征，如均匀性、独立性等。在计算伪随机数时，若使用的初值（种子）不变，那么伪随机数的数序也不变。伪随机数可以用计算机大量生成，在模拟研究中为了提高模拟效率，一般采用伪随机数代替真正的随机数。模拟中使用的一般是循环周期极长并能通过随机数检验的伪随机数，以保证计算结果的随机性。</p>
</blockquote>
<p>矩阵</p>
<blockquote>
<p><a href="https://baike.baidu.com/item/%E7%9F%A9%E9%98%B5/18069" target="_blank" rel="noopener">矩阵</a>相乘最重要的方法是一般矩阵<a href="https://baike.baidu.com/item/%E4%B9%98%E7%A7%AF" target="_blank" rel="noopener">乘积</a>。它只有在第一个矩阵的列数（column）和第二个矩阵的行数（row）相同时才有意义 。一般单指矩阵乘积时，指的便是一般矩阵乘积。一个m×n的矩阵就是m×n个数排成m行n列的一个数阵。由于它把许多数据紧凑的集中到了一起，所以有时候可以简便地表示一些复杂的模型。</p>
</blockquote>
<p>布隆过滤器</p>
<blockquote>
<p>布隆过滤器（Bloom Filter）是1970年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都远远超过一般的算法，缺点是有一定的误识别率和删除困难</p>
</blockquote>
<p>BloomFilter算法</p>
<blockquote>
<p> BloomFilter算法，是一种大数据排重算法。在一个数据量很大的集合里，能准确断定一个对象不在集合里；判断一个对象有可能在集合里，而且占用的空间不大。它不适合那种要求准确率很高的情况，零错误的场景。通过牺牲部分准确率达到高效利用空间的目的。</p>
</blockquote>
<p>函数sum和cumsum</p>
<blockquote>
<p>矩阵求和函数sum()和cumsum()函数。</p>
</blockquote>
<p>矩阵</p>
<blockquote>
<p>在数学中，矩阵（<a href="https://baike.baidu.com/item/Matrix/3543921" target="_blank" rel="noopener">Matrix</a>）是一个按照长方阵列排列的<a href="https://baike.baidu.com/item/%E5%A4%8D%E6%95%B0/254365" target="_blank" rel="noopener">复数</a>或<a href="https://baike.baidu.com/item/%E5%AE%9E%E6%95%B0/296419" target="_blank" rel="noopener">实数</a>集合 [1]  ，最早来自于<a href="https://baike.baidu.com/item/%E6%96%B9%E7%A8%8B%E7%BB%84/5695032" target="_blank" rel="noopener">方程组</a>的<a href="https://baike.baidu.com/item/%E7%B3%BB%E6%95%B0/101536" target="_blank" rel="noopener">系数</a>及<a href="https://baike.baidu.com/item/%E5%B8%B8%E6%95%B0/2215683" target="_blank" rel="noopener">常数</a>所构成的<a href="https://baike.baidu.com/item/%E6%96%B9%E9%98%B5/7362108" target="_blank" rel="noopener">方阵</a>。这一概念由19世纪英国数学家<a href="https://baike.baidu.com/item/%E5%87%AF%E5%88%A9/34600" target="_blank" rel="noopener">凯利</a>首先提出。矩阵是高等代<a href="https://baike.baidu.com/item/%E6%95%B0%E5%AD%A6/107037" target="_blank" rel="noopener">数学</a>中的常见工具，也常见于统计分析等应用数学学科中。 [2]  在物理学中，矩阵于电路学、<a href="https://baike.baidu.com/item/%E5%8A%9B%E5%AD%A6/648839" target="_blank" rel="noopener">力学</a>、光学和<a href="https://baike.baidu.com/item/%E9%87%8F%E5%AD%90%E7%89%A9%E7%90%86/7052617" target="_blank" rel="noopener">量子物理</a>中都有应用；<a href="https://baike.baidu.com/item/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/9132" target="_blank" rel="noopener">计算机科学</a>中，<a href="https://baike.baidu.com/item/%E4%B8%89%E7%BB%B4%E5%8A%A8%E7%94%BB" target="_blank" rel="noopener">三维动画</a>制作也需要用到矩阵。 矩阵的运算是<a href="https://baike.baidu.com/item/%E6%95%B0%E5%80%BC%E5%88%86%E6%9E%90/3781" target="_blank" rel="noopener">数值分析</a>领域的重要问题。将<a href="https://baike.baidu.com/item/%E7%9F%A9%E9%98%B5%E5%88%86%E8%A7%A3/4035386" target="_blank" rel="noopener">矩阵分解</a>为简单矩阵的组合可以在理论和实际应用上简化矩阵的运算。对一些应用广泛而形式特殊的矩阵，例如<a href="https://baike.baidu.com/item/%E7%A8%80%E7%96%8F%E7%9F%A9%E9%98%B5/3249303" target="_blank" rel="noopener">稀疏矩阵</a>和准对角矩阵，有特定的快速运算<a href="https://baike.baidu.com/item/%E7%AE%97%E6%B3%95/209025" target="_blank" rel="noopener">算法</a>。关于矩阵相关理论的发展和应用，请参考<a href="https://baike.baidu.com/item/%E7%9F%A9%E9%98%B5%E7%90%86%E8%AE%BA/5694289" target="_blank" rel="noopener">矩阵理论</a>。在<a href="https://baike.baidu.com/item/%E5%A4%A9%E4%BD%93%E7%89%A9%E7%90%86/8083093" target="_blank" rel="noopener">天体物理</a>、<a href="https://baike.baidu.com/item/%E9%87%8F%E5%AD%90%E5%8A%9B%E5%AD%A6/131692" target="_blank" rel="noopener">量子力学</a>等领域，也会出现<a href="https://baike.baidu.com/item/%E6%97%A0%E7%A9%B7/8284883" target="_blank" rel="noopener">无穷</a>维的矩阵，是矩阵的一种推广。</p>
</blockquote>
<p>笛卡尔坐标系</p>
<blockquote>
<p>笛卡尔坐标系（Cartesian coordinates，法语：les coordonnées cartésiennes）就是<a href="https://baike.baidu.com/item/%E7%9B%B4%E8%A7%92%E5%9D%90%E6%A0%87%E7%B3%BB/1835293" target="_blank" rel="noopener">直角坐标系</a>和斜坐标系的统称。<br>相交于原点的两条<a href="https://baike.baidu.com/item/%E6%95%B0%E8%BD%B4/10021993" target="_blank" rel="noopener">数轴</a>，构成了平面放射坐标系。如两条数轴上的度量单位相等，则称此放射坐标系为笛卡尔坐标系。两条数轴互相垂直的笛卡尔坐标系，称为笛卡尔<a href="https://baike.baidu.com/item/%E7%9B%B4%E8%A7%92" target="_blank" rel="noopener">直角</a>坐标系，否则称为笛卡尔斜角坐标系。</p>
</blockquote>
<p>exp函数</p>
<blockquote>
<p>exp，<a href="https://baike.baidu.com/item/%E9%AB%98%E7%AD%89%E6%95%B0%E5%AD%A6/1182" target="_blank" rel="noopener">高等数学</a>里以自然常数e为底的<a href="https://baike.baidu.com/item/%E6%8C%87%E6%95%B0%E5%87%BD%E6%95%B0/6013301" target="_blank" rel="noopener">指数函数</a>，常数 <strong>e</strong> 的值约为 2.718282。</p>
</blockquote>
<p>烟囱系统，数据孤岛 </p>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p>  在数据分析中，数据分为以下几种：</p>
<ol>
<li>表格型数据，其中各列可能是不同的类型，比如字符串、数值、日期等。多表现为关系型数据库和文本文件中的数据</li>
<li>多维数组（矩阵）</li>
<li>通过关键列相互联系的多个表（比如mysql关系型数据库）</li>
<li>间隔平均或不平均的时间序列</li>
</ol>
<h3 id="有关数据分析的工具"><a href="#有关数据分析的工具" class="headerlink" title="有关数据分析的工具"></a>有关数据分析的工具</h3><ul>
<li><p>Excel是最广泛应用的数据分析工具，其功能也很强大</p>
</li>
<li><p>python：</p>
<blockquote>
<p>python拥有活跃的科学计算社区，在学术领域和商业领域都有普遍的应用，用于数据科学，机器学习，web开发等多个方面。python作为一种胶水语言，能够轻松集成旧有算法和系统，不仅仅适用于研究和原型构建，同时也适用于构建生产系统</p>
</blockquote>
<p>在python做数据分析中，有一些非常重要的python库：</p>
<ol>
<li><p>NumPy(Numerical Python)<br>这是python的科学计算的基础包</p>
<ul>
<li>快速⾼效的多维数组对象ndarray。 </li>
<li>⽤于对数组执⾏元素级计算以及直接对数组执⾏数学运算的函数。 </li>
<li>⽤于读写硬盘上基于数组的数据集的⼯具。</li>
<li>线性代数运算、傅⾥叶变换，以及随机数⽣成。 </li>
<li>成熟的C API，⽤于Python插件和原⽣C、C++、Fortran代码访问NumPy的数据结构和计 算⼯具。 </li>
<li>对于数值型数据，NumPy数组在存储和处理数据时要⽐内置的Python数据结构⾼效得 多。 </li>
</ul>
</li>
<li><p>pandas</p>
<ul>
<li>pandas提供快速捷处结构化数据的数据结构和函数。</li>
<li>pandas兼具NumPy⾼性能的数组计算功能以及电⼦表格和关系型数据库（如SQL）灵活 的数据处理功能。它提供了复杂精细的索引功能，能更加便捷地完成重塑、切⽚和切块、 聚合以及选取数据⼦集等操作 。</li>
<li>数据操作、准备、清洗是数据分析最重要的技能（耗时最⻓） 。</li>
</ul>
</li>
<li><p>matplotlib</p>
<ul>
<li>最流⾏的⽤于绘制图表和其它⼆维数据可视化的Python库 </li>
<li>适合创建出版物上⽤的图表 </li>
</ul>
</li>
<li><p>IPython&amp;jupyter</p>
<ul>
<li><p>适合探索⼯作流（探索、试错、重复）的过程，因为可以实时显示</p>
</li>
<li><p>IPython web notebook     Jupyter notebook (⽀持40多种编程语⾔） </p>
</li>
<li><p>Jupyter notebook⽀持markdown和html </p>
</li>
</ul>
</li>
<li><p>Scipy</p>
<ul>
<li>⼀组专⻔解决科学计算中各种标准问题域的包的集合。 </li>
</ul>
</li>
<li>scikit-learn<ul>
<li>scikit-learn成为了Python的通⽤机器学习⼯具包 </li>
</ul>
</li>
<li>statsmodels<ul>
<li>statsmodels包含经典统计学和经济计量学的算法 </li>
</ul>
</li>
</ol>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常用模块引用惯例</span><br><span class="line">import numpy as np</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">import pandas as pd</span><br><span class="line">import statsmodels as sm</span><br></pre></td></tr></table></figure>
<p>###Jupyter Notebook</p>
<blockquote>
<p> notebook是Jupyter项⽬的重要组件之⼀，它是⼀个代码、⽂本（有标记或⽆标记）、数据可视化或其它输出的交互式⽂档。Python的Jupyter内核是使⽤IPython。 </p>
</blockquote>
<h4 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ jupyter notebook</span><br></pre></td></tr></table></figure>
<p>​    要新建⼀个notebook，点击按钮New，选择“Python3”或“conda[默认项]”。如果是第⼀次， 点击空格，输⼊⼀⾏Python代码。然后按Shift-Enter执⾏。 当保存notebook时（File⽬录下的Save and Checkpoint），会创建⼀个后缀名为.ipynb的⽂ 件。要加载存在的notebook，把它放到启动notebook进程的相同⽬录内。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看当前目录</span><br><span class="line">%pwd</span><br><span class="line">查看当前目录下的文件</span><br><span class="line">%ls</span><br></pre></td></tr></table></figure>
<p>####在变量前后使用一个问号：显示对象或函数信息，两个问号：显示源代码</p>
<p>#####Jupyter键盘快捷键：</p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析——-1/key.png" alt="key"></p>
<h4 id="魔术命令"><a href="#魔术命令" class="headerlink" title="魔术命令"></a>魔术命令</h4><p>%timeit 测量任何Python语句，例如矩阵乘法的执行时间</p>
<p>魔术命令如下：</p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析——-1/magic.png" alt="magic"></p>
<h3 id="集成Matplotlib"><a href="#集成Matplotlib" class="headerlink" title="集成Matplotlib"></a>集成Matplotlib</h3><blockquote>
<p>IPython在分析计算领域能够流⾏的原因之⼀是它⾮常好的集成了数据可视化和其它⽤户界⾯ 库，⽐如matplotlib </p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib</span><br><span class="line">import matplotlib.pyplot as plt</span><br><span class="line">plt.plot(np.random.randn(50).cumsum())</span><br></pre></td></tr></table></figure>
<p>​    打印一张随机生成50个数求和的分析图</p>
<h3 id="NumPy"><a href="#NumPy" class="headerlink" title="NumPy"></a>NumPy</h3><blockquote>
<p>   NumPy是在⼀个连续的内存块中存储数据，独⽴于其他Python内置对象。NumPy的C语⾔编 写的算法库可以操作内存，⽽不必进⾏类型检查或其它前期⼯作。⽐起Python的内置序列， NumPy数组使⽤的内存更少。 </p>
</blockquote>
<p>​    NumPy是科学计算的基础包，特点是有快速⾼效的多维数组对象ndarray，⽤于对数组执⾏元素级计算以及直接对数组执⾏数学运算的函数，⽤于读写硬盘上基于数组的数据集的⼯具，它可以高效处理大数组的数据，在整个数组上执行复杂的矢量计算。</p>
<pre><code>基于NumPy的算法要比纯Python效率高上数量级，且使用的内存更少。
</code></pre><h5 id="NumPy的ndarray：⼀种多维数组对象"><a href="#NumPy的ndarray：⼀种多维数组对象" class="headerlink" title="NumPy的ndarray：⼀种多维数组对象"></a>NumPy的ndarray：⼀种多维数组对象</h5><p>​    NumPy最重要的⼀个特点就是其N维数组对象（即ndarray），该对象是⼀个快速⽽灵活的⼤数据集容器。</p>
<h5 id="创建ndarray"><a href="#创建ndarray" class="headerlink" title="创建ndarray"></a>创建ndarray</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [<span class="number">19</span>]: data1 = [<span class="number">6</span>, <span class="number">7.5</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">In [<span class="number">20</span>]: arr1 = np.array(data1)</span><br><span class="line">In [<span class="number">21</span>]: arr1</span><br><span class="line">Out[<span class="number">21</span>]: array([ <span class="number">6.</span> ,  <span class="number">7.5</span>,  <span class="number">8.</span> ,  <span class="number">0.</span> ,  <span class="number">1.</span> ])</span><br></pre></td></tr></table></figure>
<h5 id="ndarray是⼀个通⽤的同构数据多维容器，所有元素必须是相同类型的"><a href="#ndarray是⼀个通⽤的同构数据多维容器，所有元素必须是相同类型的" class="headerlink" title="ndarray是⼀个通⽤的同构数据多维容器，所有元素必须是相同类型的"></a>ndarray是⼀个通⽤的同构数据多维容器，所有元素必须是相同类型的</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#  取维度⼤⼩</span><br><span class="line">data.shape</span><br><span class="line">#  取数据数据类型</span><br><span class="line">data.dtype</span><br></pre></td></tr></table></figure>
<h5 id="嵌套序列（⽐如由⼀组等⻓列表组成的列表）将会被转换为⼀个多维数组"><a href="#嵌套序列（⽐如由⼀组等⻓列表组成的列表）将会被转换为⼀个多维数组" class="headerlink" title="嵌套序列（⽐如由⼀组等⻓列表组成的列表）将会被转换为⼀个多维数组"></a>嵌套序列（⽐如由⼀组等⻓列表组成的列表）将会被转换为⼀个多维数组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [22]: data2 = [[1, 2, 3, 4], [5, 6, 7, 8]]</span><br><span class="line">In [23]: arr2 = np.array(data2)</span><br><span class="line">In [24]: arr2</span><br><span class="line">Out[24]:</span><br><span class="line">	array([[1, 2, 3, 4],</span><br><span class="line">		[5, 6, 7, 8]])</span><br><span class="line">#  取维度</span><br><span class="line">arr2.ndim</span><br><span class="line">arr2.shape</span><br><span class="line">arr2.dtype</span><br></pre></td></tr></table></figure>
<p>​    你可以利⽤这种数组对整块数据执⾏⼀些数学运算，其语法跟标量元素之间的运 算⼀样。 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [12]: import numpy as np</span><br><span class="line">In [13]: data = np.random.randn(2, 3)</span><br><span class="line">In [14]: data</span><br><span class="line">Out[14]:</span><br><span class="line">array([[-0.2047,  0.4789, -0.5194],</span><br><span class="line">[-0.5557,  1.9658,  1.3934]])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">In [15]: data * 10</span><br><span class="line">Out[15]:</span><br><span class="line">array([[ -2.0471,   4.7894,  -5.1944],</span><br><span class="line">[ -5.5573,  19.6578,  13.9341]])</span><br><span class="line">In [16]: data + data</span><br><span class="line">Out[16]:</span><br><span class="line">array([[-0.4094,  0.9579, -1.0389],</span><br><span class="line">[-1.1115,  3.9316,  2.7868]])</span><br></pre></td></tr></table></figure>
<h5 id="zeros和ones分别可以创建指定⻓度或形状的全0或全1数组。empty可以创建⼀个没有任何具-体值的数组"><a href="#zeros和ones分别可以创建指定⻓度或形状的全0或全1数组。empty可以创建⼀个没有任何具-体值的数组" class="headerlink" title="zeros和ones分别可以创建指定⻓度或形状的全0或全1数组。empty可以创建⼀个没有任何具 体值的数组"></a>zeros和ones分别可以创建指定⻓度或形状的全0或全1数组。empty可以创建⼀个没有任何具 体值的数组</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [29]: np.zeros(10)</span><br><span class="line">Out[29]: array([ 0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.,  0.])</span><br><span class="line">In [30]: np.zeros((3, 6))</span><br><span class="line">Out[30]:</span><br><span class="line">array([[ 0.,  0.,  0.,  0.,  0.,  0.],</span><br><span class="line">[ 0.,  0.,  0.,  0.,  0.,  0.],</span><br><span class="line">[ 0.,  0.,  0.,  0.,  0.,  0.]])</span><br><span class="line">In [31]: np.empty((2, 3, 2))</span><br><span class="line">np.ones(10)</span><br><span class="line"></span><br><span class="line"># 生成15个元素的数组</span><br><span class="line">In [32]: np.arange(15)</span><br><span class="line">Out[32]: array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14])</span><br></pre></td></tr></table></figure>
<p>​    np.empty返回的都是⼀些未初始化的垃圾值 </p>
<p>以下是关于这些函数的说明：</p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析——-1/ndarray.png" alt="ndarray"></p>
<h5 id="ndarray的数据类型"><a href="#ndarray的数据类型" class="headerlink" title="ndarray的数据类型"></a>ndarray的数据类型</h5><p>ndarray的数据类型有float64/32/128，int64/32/128，他们之间可以互相转换，在省城ndarray时也可以指定dtype，如果不指定一般默认为int或float64</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [33]: arr1 = np.array([1, 2, 3], dtype=np.float64)</span><br><span class="line">In [34]: arr2 = np.array([1, 2, 3], dtype=np.int32)</span><br><span class="line">In [35]: arr1.dtype</span><br><span class="line">Out[35]: dtype(&apos;float64&apos;)</span><br><span class="line">In [36]: arr2.dtype</span><br><span class="line">Out[36]: dtype(&apos;int32&apos;)</span><br></pre></td></tr></table></figure>
<h5 id="将浮点数转换成整数，则⼩数部分将会被截取删除"><a href="#将浮点数转换成整数，则⼩数部分将会被截取删除" class="headerlink" title="将浮点数转换成整数，则⼩数部分将会被截取删除"></a>将浮点数转换成整数，则⼩数部分将会被截取删除</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [41]: arr = np.array([3.7, -1.2, -2.6, 0.5, 12.9, 10.1])</span><br><span class="line">In [42]: arr</span><br><span class="line">Out[42]: array([  3.7,  -1.2,  -2.6,   0.5,  12.9,  10.1])</span><br><span class="line">In [43]: arr.astype(np.int32)</span><br><span class="line">Out[43]: array([ 3, -1, -2,  0, 12, 10], dtype=int32)</span><br></pre></td></tr></table></figure>
<p>​    调⽤astype总会创建⼀个新的数组（⼀个数据的备份） </p>
<h4 id="NumPy数组的批量运算"><a href="#NumPy数组的批量运算" class="headerlink" title="NumPy数组的批量运算"></a>NumPy数组的批量运算</h4><p>​    不⽤编写循环即可对数据执⾏批量运算。NumPy⽤户称其为矢量化（vectorization）。⼤⼩相 等的数组之间的任何算术运算都会将运算应⽤到元素级 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [51]: arr = np.array([[1., 2., 3.], [4., 5., 6.]])</span><br><span class="line">In [52]: arr</span><br><span class="line">Out[52]:</span><br><span class="line">array([[ 1.,  2.,  3.],</span><br><span class="line">[ 4.,  5.,  6.]])</span><br><span class="line">In [53]: arr * arr</span><br><span class="line">Out[53]:</span><br><span class="line">array([[  1.,   4.,   9.],</span><br><span class="line">[ 16.,  25.,  36.]])</span><br><span class="line">In [54]: arr - arr</span><br><span class="line">Out[54]:</span><br><span class="line">array([[ 0.,  0.,  0.],</span><br><span class="line">[ 0.,  0.,  0.]])</span><br></pre></td></tr></table></figure>
<p>数组与标量的算术运算会将标量值传播到各个元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [55]: 1 / arr</span><br><span class="line">Out[55]:</span><br><span class="line">array([[ 1.</span><br><span class="line">,  0.5   ,  0.3333],</span><br><span class="line">[ 0.25  ,  0.2   ,  0.1667]])</span><br><span class="line">In [56]: arr * 0.5</span><br></pre></td></tr></table></figure>
<p> 数组之间的⽐较会⽣成布尔值数组 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [57]: arr2 = np.array([[0., 4., 1.], [7., 2., 12.]])</span><br><span class="line">In [58]: arr2</span><br><span class="line">Out[58]:</span><br><span class="line">array([[  0.,   4.,   1.],</span><br><span class="line">[  7.,   2.,  12.]])</span><br><span class="line">In [59]: arr2 &gt; arr</span><br><span class="line">Out[59]:</span><br><span class="line">array([[False,  True, False],</span><br><span class="line">[ True, False,  True]], dtype=bool)</span><br></pre></td></tr></table></figure>
<h4 id="索引和切⽚"><a href="#索引和切⽚" class="headerlink" title="索引和切⽚"></a>索引和切⽚</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [60]: arr = np.arange(10)</span><br><span class="line">In [61]: arr</span><br><span class="line">Out[61]: array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">In [62]: arr[5]</span><br><span class="line">Out[62]: 5</span><br><span class="line">In [63]: arr[5:8]</span><br><span class="line">Out[63]: array([5, 6, 7])</span><br><span class="line"> </span><br><span class="line">In [64]: arr[5:8] = 12</span><br><span class="line">In [65]: arr</span><br><span class="line">Out[65]: array([ 0,  1,  2,  3,  4, 12, 12, 12,  8,  9])</span><br><span class="line">In [66]: arr_slice = arr[5:8]</span><br><span class="line">In [67]: arr_slice</span><br><span class="line">Out[67]: array([12, 12, 12])</span><br><span class="line">In [68]: arr_slice[1] = 12345</span><br><span class="line">In [69]: arr</span><br><span class="line">Out[69]: array([0,1,2,3,4,12, 12345,12,8,9])</span><br></pre></td></tr></table></figure>
<p>切⽚[ : ]会给数组中的所有值赋值 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [70]: arr_slice[:] = 64</span><br><span class="line">In [71]: arr</span><br><span class="line">Out[71]: array([ 0,  1,  2,  3,  4, 64, 64, 64,  8,  9])</span><br></pre></td></tr></table></figure>
<p>ndarray切⽚的⼀份副本⽽⾮视图，就需要明确地进⾏复制操作，例如arr[5:8].copy() </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [72]: arr2d = np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]])</span><br><span class="line">In [73]: arr2d[2]</span><br><span class="line">Out[73]: array([7, 8, 9])</span><br><span class="line">#  两种⽅式⼀样</span><br><span class="line">In [74]: arr2d[0][2]</span><br><span class="line">Out[74]: 3</span><br><span class="line">In [75]: arr2d[0, 2]</span><br><span class="line">Out[75]: 3</span><br></pre></td></tr></table></figure>
<p>多维数组中，如果省略了后⾯的索引，则返回对象会是⼀个维度低⼀点的ndarray </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [76]: arr3d = np.array([[[1, 2, 3], [4, 5, 6]], [[7, 8, 9], [10, 11, 12]]])</span><br><span class="line">In [77]: arr3d</span><br><span class="line">Out[77]:</span><br><span class="line">array([[[ 1,  2,  3],</span><br><span class="line">[ 4,  5,  6]],</span><br><span class="line">[[ 7,  8,  9],</span><br><span class="line">[10, 11, 12]]])</span><br><span class="line">In [78]: arr3d[0]</span><br><span class="line">Out[78]:</span><br><span class="line">array([[1, 2, 3],</span><br><span class="line">[4, 5, 6]])</span><br></pre></td></tr></table></figure>
<p>标量值和数组都可以被赋值给arr3d[0] </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [79]: old_values = arr3d[0].copy()</span><br><span class="line">In [80]: arr3d[0] = 42</span><br><span class="line">In [81]: arr3d</span><br><span class="line">Out[81]:</span><br><span class="line">array([[[42, 42, 42],</span><br><span class="line">[42, 42, 42]],</span><br><span class="line">[[ 7,  8,  9],</span><br><span class="line">[10, 11, 12]]])</span><br><span class="line">In [82]: arr3d[0] = old_values</span><br><span class="line">In [83]: arr3d</span><br><span class="line">Out[83]:</span><br><span class="line">array([[[ 1,  2,  3],</span><br><span class="line">[ 4,  5,  6]],</span><br><span class="line">[[ 7,  8,  9],</span><br><span class="line">[10, 11, 12]]])</span><br><span class="line">In [84]: arr3d[1, 0]</span><br><span class="line">Out[84]: array([7, 8, 9])</span><br></pre></td></tr></table></figure>
<p>切⽚索引 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">In [90]: arr2d</span><br><span class="line">Out[90]:</span><br><span class="line">array([[1, 2, 3],</span><br><span class="line">[4, 5, 6],</span><br><span class="line">[7, 8, 9]])</span><br><span class="line">In [91]: arr2d[:2]</span><br><span class="line">Out[91]:</span><br><span class="line">array([[1, 2, 3],</span><br><span class="line">[4, 5, 6]])</span><br></pre></td></tr></table></figure>
<p>⼀次传⼊多个切⽚ </p>
<p><strong>第二个切片参数代表的是每一个子对象里的序列号</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [92]: arr2d[:2, 1:]</span><br><span class="line">Out[92]:</span><br><span class="line">array([[2, 3],</span><br><span class="line">[5, 6]])</span><br></pre></td></tr></table></figure>
<p>将整数索引和切⽚混合选取第⼆⾏的前两列 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [93]: arr2d[1, :2]</span><br><span class="line">Out[93]: array([4, 5])</span><br></pre></td></tr></table></figure>
<p>选择第三列的前两⾏ </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [94]: arr2d[:2, 2]</span><br><span class="line">Out[94]: array([3, 6])</span><br></pre></td></tr></table></figure>
<p>“只有冒号”表示选取整个轴 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">In [95]: arr2d[:, :1]</span><br><span class="line">Out[95]:</span><br><span class="line">array([[1],</span><br><span class="line">[4],</span><br><span class="line">[7]])</span><br><span class="line">In [96]: arr2d[:2, 1:] = 0</span><br><span class="line">In [97]: arr2d</span><br><span class="line">Out[97]:</span><br><span class="line">array([[1, 0, 0],</span><br><span class="line">[4, 0, 0],</span><br><span class="line">[7, 8, 9]])</span><br></pre></td></tr></table></figure>
<p>#####布尔型索引 </p>
<p>假设我们有⼀个⽤于存储数据的数组以及⼀个存储姓名的数组（含有重复项） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">In [98]: names = np.array([&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;, &apos;Bob&apos;, &apos;Will&apos;, &apos;Joe&apos;, &apos;Joe&apos;])</span><br><span class="line">In [99]: data = np.random.randn(7, 4)</span><br><span class="line">In [100]: names</span><br><span class="line">Out[100]:</span><br><span class="line">array([&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;, &apos;Bob&apos;, &apos;Will&apos;, &apos;Joe&apos;, &apos;Joe&apos;],</span><br><span class="line">dtype=&apos;&lt;U4&apos;)</span><br><span class="line">In [101]: data</span><br><span class="line">Out[101]:</span><br><span class="line">array([[ 0.0929,  0.2817,  0.769 ,  1.2464],</span><br><span class="line">[ 1.0072, -1.2962,  0.275 ,  0.2289],</span><br><span class="line">[ 1.3529,  0.8864, -2.0016, -0.3718],</span><br><span class="line">[ 1.669 , -0.4386, -0.5397,  0.477 ],</span><br><span class="line">[ 3.2489, -1.0212, -0.5771,  0.1241],</span><br><span class="line">[ 0.3026,  0.5238,  0.0009,  1.3438],</span><br><span class="line">[-0.7135, -0.8312, -2.3702, -1.8608]])</span><br><span class="line">In [102]: names == &apos;Bob&apos;</span><br><span class="line">Out[102]: array([ True, False, False,  True, False, False, False], dtype=bool)</span><br><span class="line">In [103]: data[names == &apos;Bob&apos;]</span><br><span class="line">Out[103]:</span><br><span class="line">array([[ 0.0929,  0.2817,  0.769 ,  1.2464],</span><br><span class="line">[ 1.669 , -0.4386, -0.5397,  0.477 ]])</span><br><span class="line">In [104]: data[names == &apos;Bob&apos;, 2:]</span><br><span class="line">Out[104]:</span><br><span class="line">array([[ 0.769 ,  1.2464],</span><br><span class="line">[-0.5397,  0.477 ]])</span><br><span class="line">In [105]: data[names == &apos;Bob&apos;, 3]</span><br><span class="line">Out[105]: array([ 1.2464,  0.477 ])</span><br></pre></td></tr></table></figure>
<h5 id="要选择除”bob”以外的其他值，既可以使⽤不等于符号（-），也可以通过-对条件进⾏否定（data-names-‘Bob’-，data-data-lt-0-0-）"><a href="#要选择除”bob”以外的其他值，既可以使⽤不等于符号（-），也可以通过-对条件进⾏否定（data-names-‘Bob’-，data-data-lt-0-0-）" class="headerlink" title="要选择除”bob”以外的其他值，既可以使⽤不等于符号（!=），也可以通过~对条件进⾏否定（data[~(names == ‘Bob’)]，data[data &lt; 0] = 0 ）"></a>要选择除”bob”以外的其他值，既可以使⽤不等于符号（!=），也可以通过~对条件进⾏否定（data[~(names == ‘Bob’)]，data[data &lt; 0] = 0 ）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">In [106]: names != &apos;Bob&apos;</span><br><span class="line">Out[106]: array([False,  True,  True, False,  True,  True,  True], dtype=bool)</span><br><span class="line"></span><br><span class="line">In [107]: data[~(names == &apos;Bob&apos;)]</span><br><span class="line">Out[107]:</span><br><span class="line">array([[ 1.0072, -1.2962,  0.275 ,  0.2289],</span><br><span class="line">[ 1.3529,  0.8864, -2.0016, -0.3718],</span><br><span class="line">[ 3.2489, -1.0212, -0.5771,  0.1241],</span><br><span class="line">[ 0.3026,  0.5238,  0.0009,  1.3438],</span><br><span class="line">[-0.7135, -0.8312, -2.3702, -1.8608]])</span><br><span class="line"></span><br><span class="line">In [110]: mask = (names == &apos;Bob&apos;) | (names == &apos;Will&apos;)</span><br><span class="line">In [111]: mask</span><br><span class="line">Out[111]: array([ True, False,  True,  True,  True, False, False], dtype=bool)</span><br><span class="line">In [112]: data[mask]</span><br><span class="line">Out[112]:</span><br><span class="line">array([[ 0.0929,  0.2817,  0.769 ,  1.2464],</span><br><span class="line">[ 1.3529,  0.8864, -2.0016, -0.3718],</span><br><span class="line">[ 1.669 , -0.4386, -0.5397,  0.477 ],</span><br><span class="line">[ 3.2489, -1.0212, -0.5771,  0.1241]])</span><br><span class="line">In [113]: data[data &lt; 0] = 0</span><br><span class="line"></span><br><span class="line">In [114]: data</span><br><span class="line">Out[114]:</span><br><span class="line">array([[ 0.0929,  0.2817,  0.769 ,  1.2464],[ 1.0072,  0.,  0.275 ,  0.2289],,  0.[ 1.3529,  0.8864,  0.],[ 1.669 ,  0.[ 3.2489,  0.,  0.,  0.,  0.477 ],,  0.1241],[ 0.3026,  0.5238,  0.0009,  1.3438],[ 0.    ,  0.    ,  0.    ,  0.]])</span><br><span class="line"></span><br><span class="line">In [115]: data[names != &apos;Joe&apos;] = 7</span><br><span class="line">In [116]: data</span><br><span class="line">Out[116]:</span><br><span class="line">array([[ 7.,  7.,  7.    ,  7.    ],[ 1.0072,  0.,  0.275 ,  0.2289],</span><br><span class="line">[ 7.[ 7.[ 7.,  7.,  7.,  7.,  7.,  7.,  7.,  7.,  7.,  7.],],],[ 0.3026,  0.5238,  0.0009,  1.3438],[ 0.    ,  0.    ,  0.    ,  0.]])</span><br></pre></td></tr></table></figure>
<h4 id="花式索引"><a href="#花式索引" class="headerlink" title="花式索引"></a>花式索引</h4><p>​    花式索引（Fancy indexing）是⼀个NumPy术语，它指的是利⽤整数数组进⾏索引 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [117]: arr = np.empty((8, 4))</span><br><span class="line">In [118]: for i in range(8):</span><br><span class="line">.....:</span><br><span class="line">arr[i] = i</span><br><span class="line">In [119]: arr</span><br><span class="line">Out[119]:</span><br><span class="line">array([[ 0.,  0.,  0.,  0.],</span><br><span class="line">[ 1.,  1.,  1.,  1.],</span><br><span class="line">[ 2.,  2.,  2.,  2.],</span><br><span class="line">[ 3.,  3.,  3.,  3.],</span><br><span class="line">[ 4.,  4.,  4.,  4.],</span><br><span class="line">[ 5.,  5.,  5.,  5.],</span><br><span class="line">[ 6.,  6.,  6.,  6.],</span><br><span class="line">[ 7.,  7.,  7.,  7.]])</span><br></pre></td></tr></table></figure>
<p>为了以特定顺序选取⾏⼦集，只需传⼊⼀个⽤于指定顺序的整数列表或ndarray即可 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [120]: arr[[4, 3, 0, 6]]</span><br><span class="line">Out[120]:</span><br><span class="line">array([[ 4.,  4.,  4.,  4.],</span><br><span class="line">[ 3.,  3.,  3.,  3.],</span><br><span class="line">[ 0.,  0.,  0.,  0.],</span><br><span class="line">[ 6.,  6.,  6.,  6.]])</span><br><span class="line"></span><br><span class="line">使⽤负数索引将会从末尾开始选取⾏</span><br><span class="line">In [121]: arr[[-3, -5, -7]]</span><br><span class="line">Out[121]:</span><br><span class="line">array([[ 5.,  5.,  5.,  5.],</span><br><span class="line">[ 3.,  3.,  3.,  3.],</span><br><span class="line">[ 1.,  1.,  1.,  1.]])</span><br></pre></td></tr></table></figure>
<p>⼀次传⼊多个索引数组会有⼀点特别。它返回的是⼀个⼀维数组，其中的元素对应各个索引元组 。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">In [122]: arr = np.arange(32).reshape((8, 4))</span><br><span class="line">In [123]: arr</span><br><span class="line">Out[123]:</span><br><span class="line">array([[ 0,  1,  2,  3],</span><br><span class="line">[ 4,  5,  6,  7],</span><br><span class="line">[ 8,  9, 10, 11],</span><br><span class="line">[12, 13, 14, 15],</span><br><span class="line">[16, 17, 18, 19],</span><br><span class="line">[20, 21, 22, 23],</span><br><span class="line">[24, 25, 26, 27],</span><br><span class="line">[28, 29, 30, 31]])</span><br><span class="line"># 最终选出的是元素(1,0)、(5,3)、(7,1)和(2,2)</span><br><span class="line">In [124]: arr[[1, 5, 7, 2], [0, 3, 1, 2]]</span><br><span class="line">Out[124]: array([ 4, 23, 29, 10])</span><br><span class="line">In [125]: arr[[1, 5, 7, 2]][:, [0, 3, 1, 2]]</span><br><span class="line">Out[125]:</span><br><span class="line">array([[ 4,  7,  5,  6],</span><br></pre></td></tr></table></figure>
<p>####数组转置和轴对换</p>
<p>转置是重塑的⼀种特殊形式，它返回的是源数据的视图（不会进⾏任何复制操作） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [126]: arr = np.arange(15).reshape((3, 5))</span><br><span class="line">In [127]: arr</span><br><span class="line">Out[127]:</span><br><span class="line">array([[ 0,  1,  2,  3,  4],</span><br><span class="line">[ 5,  6,  7,  8,  9],</span><br><span class="line">[10, 11, 12, 13, 14]])</span><br><span class="line">In [128]: arr.T</span><br><span class="line">Out[128]:</span><br><span class="line">array([[ 0,  5, 10],</span><br><span class="line">[ 1,  6, 11],</span><br><span class="line">[ 2,  7, 12],</span><br><span class="line">[ 3,  8, 13],</span><br><span class="line">[ 4,  9, 14]])</span><br></pre></td></tr></table></figure>
<h5 id="利⽤np-dot计算矩阵内积"><a href="#利⽤np-dot计算矩阵内积" class="headerlink" title="利⽤np.dot计算矩阵内积"></a>利⽤np.dot计算矩阵内积</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [129]: arr = np.random.randn(6, 3)</span><br><span class="line">In [130]: arr</span><br><span class="line">Out[130]:</span><br><span class="line">array([[-0.8608,  0.5601, -1.2659],</span><br><span class="line">[ 0.1198, -1.0635,  0.3329],</span><br><span class="line">[-2.3594, -0.1995, -1.542 ],</span><br><span class="line">[-0.9707, -1.307 ,  0.2863],</span><br><span class="line">[ 0.378 , -0.7539,  0.3313],</span><br><span class="line">[ 1.3497,  0.0699,  0.2467]])</span><br><span class="line">In [131]: np.dot(arr.T, arr)</span><br><span class="line">Out[131]:</span><br><span class="line">array([[ 9.2291,  0.9394,  4.948 ],</span><br><span class="line">[ 0.9394,  3.7662, -1.3622],</span><br><span class="line">[ 4.948 , -1.3622,  4.3437]])</span><br></pre></td></tr></table></figure>
<p>对于⾼维数组，transpose需要得到⼀个由轴编号组成的元组才能对这些轴进⾏转置 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">In [132]: arr = np.arange(16).reshape((2, 2, 4))</span><br><span class="line">In [133]: arr</span><br><span class="line">Out[133]:</span><br><span class="line">array([[[ 0,  1,  2,  3],</span><br><span class="line">[ 4,  5,  6,  7]],</span><br><span class="line">[[ 8,  9, 10, 11],</span><br><span class="line">[12, 13, 14, 15]]])</span><br><span class="line">In [134]: arr.transpose((1, 0, 2))</span><br><span class="line">Out[134]:</span><br><span class="line">array([[[ 0,  1,  2,  3],</span><br><span class="line">[ 8,  9, 10, 11]],</span><br><span class="line">[[ 4,  5,  6,  7],</span><br><span class="line">[12, 13, 14, 15]]])</span><br><span class="line"></span><br><span class="line">In [135]: arr</span><br><span class="line">Out[135]:</span><br><span class="line">array([[[ 0,  1,  2,  3],</span><br><span class="line">[ 4,  5,  6,  7]],</span><br><span class="line">[[ 8,  9, 10, 11],</span><br><span class="line">[12, 13, 14, 15]]])</span><br><span class="line"></span><br><span class="line">In [136]: arr.swapaxes(1, 2)</span><br><span class="line">Out[136]:</span><br><span class="line">array([[[ 0,  4],</span><br><span class="line">[ 1,  5],</span><br><span class="line">[ 2,  6],</span><br><span class="line">[ 3,  7]],</span><br><span class="line">[[ 8, 12],</span><br><span class="line">[ 9, 13],</span><br><span class="line">[10, 14],</span><br><span class="line">[11, 15]]])</span><br><span class="line">arr.swapaxes(0, 1)</span><br></pre></td></tr></table></figure>
<p><a href="https://blog.csdn.net/qq_21046135/article/details/71249195" target="_blank" rel="noopener">https://blog.csdn.net/qq_21046135/article/details/71249195</a></p>
<h4 id="通⽤函数-ufunc-：快速的元素级数组函数"><a href="#通⽤函数-ufunc-：快速的元素级数组函数" class="headerlink" title="通⽤函数(ufunc)：快速的元素级数组函数"></a>通⽤函数(ufunc)：快速的元素级数组函数</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [137]: arr = np.arange(10)</span><br><span class="line">In [138]: arr</span><br><span class="line">Out[138]: array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br><span class="line">In [139]: np.sqrt(arr)</span><br><span class="line">Out[139]:</span><br><span class="line">array([ 0.</span><br><span class="line">,  1.</span><br><span class="line">,  1.4142,  1.7321,  2.</span><br><span class="line">,  2.2361,  2.4495,</span><br><span class="line">2.6458,  2.8284,  3.</span><br><span class="line">])</span><br><span class="line">In [140]: np.exp(arr)</span><br><span class="line">Out[140]:</span><br><span class="line">array([</span><br><span class="line">1.</span><br><span class="line">,</span><br><span class="line">2.7183,</span><br><span class="line">7.3891,</span><br><span class="line">20.0855,</span><br><span class="line">54.5982,</span><br><span class="line">148.4132,   403.4288,  1096.6332,  2980.958 ,  8103.0839])</span><br></pre></td></tr></table></figure>
<p>add或maximum接受2个数组（因此也叫⼆元（binary）ufunc），并返回⼀个结果数组 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [141]: x = np.random.randn(8)</span><br><span class="line">In [142]: y = np.random.randn(8)</span><br><span class="line">In [143]: x</span><br><span class="line">Out[143]:</span><br><span class="line">array([-0.0119,  1.0048,  1.3272, -0.9193, -1.5491,  0.0222,  0.7584,</span><br><span class="line">-0.6605])</span><br><span class="line">In [144]: y</span><br><span class="line">Out[144]:</span><br><span class="line">array([ 0.8626, -0.01  ,  0.05  ,  0.6702,  0.853 , -0.9559, -0.0235,</span><br><span class="line">-2.3042])</span><br><span class="line">In [145]: np.maximum(x, y)</span><br><span class="line">Out[145]:</span><br><span class="line">array([ 0.8626,  1.0048,  1.3272,  0.6702,  0.853 ,  0.0222,  0.7584,</span><br><span class="line">-0.6605])</span><br></pre></td></tr></table></figure>
<p>返回浮点数数组的⼩数和整数部分 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">In [146]: arr = np.random.randn(7) * 5</span><br><span class="line">In [147]: arr</span><br><span class="line">Out[147]: array([-3.2623, -6.0915, -6.663 ,  5.3731,  3.6182,  3.45  ,</span><br><span class="line">5.0077])</span><br><span class="line">In [148]: remainder, whole_part = np.modf(arr)</span><br><span class="line">In [149]: remainder</span><br><span class="line">Out[149]: array([-0.2623, -0.0915, -0.663 ,  0.3731,</span><br><span class="line">0.6182,  0.45  ,  0.0077])</span><br><span class="line">In [150]: whole_part</span><br><span class="line">Out[150]: array([-3., -6., -6.,  5.,  3.,  3.,  5.])</span><br></pre></td></tr></table></figure>
<p>####利⽤数组进⾏数据处理</p>
<p>​    ⽤数组表达式代替循环的做法，通常被称为⽮量化。⼀般来说，⽮量化数组运算要⽐等价的纯 Python⽅式快上⼀两个数量级（甚⾄更多）。 假设我们想要在⼀组值（⽹格型）上计算函数sqrt(x^2+y^2) np.meshgrid函数接受两个⼀维数组，并产⽣两个⼆维矩阵（对应于两个数组中所有的(x,y) 对）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">In [155]: points = np.arange(-5, 5, 0.01) # 1000 equally spaced points</span><br><span class="line">In [156]: xs, ys = np.meshgrid(points, points)</span><br><span class="line">In [157]: ys</span><br><span class="line">Out[157]:</span><br><span class="line">array([[-5.  , -5.  , -5.  , ..., -5.  , -5.  , -5.  ],</span><br><span class="line">[-4.99, -4.99, -4.99, ..., -4.99, -4.99, -4.99],</span><br><span class="line">[-4.98, -4.98, -4.98, ..., -4.98, -4.98, -4.98],</span><br><span class="line">...,</span><br><span class="line">[ 4.97,  4.97,  4.97, ...,  4.97,  4.97,  4.97],</span><br><span class="line">[ 4.98,  4.98,  4.98, ...,  4.98,  4.98,  4.98],</span><br><span class="line">[ 4.99,  4.99,  4.99, ...,  4.99,  4.99,  4.99]])</span><br><span class="line">In [158]: z = np.sqrt(xs ** 2 + ys ** 2)</span><br><span class="line">In [159]: z</span><br><span class="line">Out[159]:</span><br><span class="line">array([[ 7.0711,  7.064 ,  7.0569, ...,  7.0499,  7.0569,  7.064 ],</span><br><span class="line">[ 7.064 ,  7.0569,  7.0499, ...,  7.0428,  7.0499,  7.0569],</span><br><span class="line">[ 7.0569,  7.0499,  7.0428, ...,  7.0357,  7.0428, 7.0499],</span><br><span class="line">...,</span><br><span class="line">[ 7.0499,  7.0428,  7.0357, ...,  7.0286,  7.0357,  7.0428],</span><br><span class="line">[ 7.0569,  7.0499,  7.0428, ...,  7.0357,  7.0428,  7.0499],</span><br><span class="line">[ 7.064 ,  7.0569,  7.0499, ...,  7.0428,  7.0499,  7.0569]])</span><br></pre></td></tr></table></figure>
<p>#####matplotlib创建了这个⼆维数组的可视化 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [160]: import matplotlib.pyplot as plt</span><br><span class="line">In [161]: plt.imshow(z, cmap=plt.cm.gray); plt.colorbar()</span><br><span class="line">Out[161]: &lt;matplotlib.colorbar.Colorbar at 0x7f715e3fa630&gt;</span><br><span class="line">In [162]: plt.title(&quot;Image plot of $\sqrt&#123;x^2 + y^2&#125;$ for a grid of values&quot;)</span><br><span class="line">Out[162]: &lt;matplotlib.text.Text at 0x7f715d2de748&gt;</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<h5 id="将条件逻辑表述为数组运算"><a href="#将条件逻辑表述为数组运算" class="headerlink" title="将条件逻辑表述为数组运算"></a>将条件逻辑表述为数组运算</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [165]: xarr = np.array([1.1, 1.2, 1.3, 1.4, 1.5])</span><br><span class="line">In [166]: yarr = np.array([2.1, 2.2, 2.3, 2.4, 2.5])</span><br><span class="line">In [167]: cond = np.array([True, False, True, True, False])</span><br></pre></td></tr></table></figure>
<p>当cond中的值为True时，选取xarr的值，否则从yarr中选取 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [170]: result = np.where(cond, xarr, yarr)</span><br><span class="line">In [171]: result</span><br><span class="line">Out[171]: array([ 1.1,  2.2,  1.3,  1.4,  2.5])</span><br></pre></td></tr></table></figure>
<p>假设有⼀个由随机数据组成的矩阵，你希望将所有正值替换为2，将所有负值替换为－2 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [172]: arr = np.random.randn(4, 4)</span><br><span class="line">In [173]: arr</span><br><span class="line">Out[173]:</span><br><span class="line">array([[-0.5031, -0.6223, -0.9212, -0.7262],</span><br><span class="line">[ 0.2229,  0.0513, -1.1577,  0.8167],</span><br><span class="line">[ 0.4336,  1.0107,  1.8249, -0.9975],</span><br><span class="line">[ 0.8506, -0.1316,  0.9124,  0.1882]])</span><br><span class="line">In [174]: arr &gt; 0</span><br><span class="line">Out[174]:</span><br><span class="line">array([[False, False, False, False],</span><br><span class="line">[ True,  True, False,  True],</span><br><span class="line">[ True,  True,  True, False],</span><br><span class="line">[ True, False,  True,  True]], dtype=bool)</span><br><span class="line">In [175]: np.where(arr &gt; 0, 2, -2)</span><br><span class="line">Out[175]:</span><br><span class="line">array([[-2, -2, -2, -2],</span><br><span class="line">[ 2,  2, -2,  2],</span><br><span class="line">[ 2,  2,  2, -2],</span><br><span class="line">[ 2, -2,  2,  2]])</span><br></pre></td></tr></table></figure>
<p>⽤常数2替换arr中所有正的值 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">In [176]: np.where(arr &gt; 0, 2, arr)</span><br><span class="line">Out[176]:</span><br><span class="line">array([[-0.5031, -0.6223, -0.9212, -0.7262],</span><br><span class="line">[ 2.</span><br><span class="line">[ 2.</span><br><span class="line">[ 2.</span><br><span class="line">,  2.</span><br><span class="line">,  2.</span><br><span class="line">, -1.1577,  2.    ],</span><br><span class="line">,  2.    , -0.9975],</span><br><span class="line">,  2.</span><br><span class="line">, -0.1316,  2.</span><br><span class="line">]])</span><br></pre></td></tr></table></figure>
<h4 id="数学和统计⽅法"><a href="#数学和统计⽅法" class="headerlink" title="数学和统计⽅法"></a>数学和统计⽅法</h4><p>​    可以通过数组上的⼀组数学函数对整个数组或某个轴向的数据进⾏统计计算。sum、mean以 及标准差std等聚合计算（aggregation，通常叫做约简（reduction）） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">In [177]: arr = np.random.randn(5, 4)</span><br><span class="line">In [178]: arr</span><br><span class="line">Out[178]:</span><br><span class="line">array([[ 2.1695, -0.1149,  2.0037,  0.0296],</span><br><span class="line">[ 0.7953,  0.1181, -0.7485,  0.585 ],</span><br><span class="line">[ 0.1527, -1.5657, -0.5625, -0.0327],</span><br><span class="line">[-0.929 , -0.4826, -0.0363,  1.0954],</span><br><span class="line">[ 0.9809, -0.5895,  1.5817, -0.5287]])</span><br><span class="line">In [179]: arr.mean()</span><br><span class="line">Out[179]: 0.19607051119998253</span><br><span class="line">In [180]: np.mean(arr)</span><br><span class="line">Out[180]: 0.19607051119998253</span><br><span class="line">In [181]: arr.sum()</span><br><span class="line">Out[181]: 3.9214102239996507</span><br></pre></td></tr></table></figure>
<p>arr.mean(1)是“计算⾏的平均值”，arr.sum(0)是“计算每列的和” </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">In [182]: arr.mean(axis=1)</span><br><span class="line">Out[182]: array([ 1.022 ,  0.1875, -0.502 , -0.0881,  0.3611])</span><br><span class="line">In [183]: arr.sum(axis=0)</span><br><span class="line">Out[183]: array([ 3.1693, -2.6345,  2.2381,  1.1486])</span><br><span class="line">In [184]: arr = np.array([0, 1, 2, 3, 4, 5, 6, 7])</span><br><span class="line">In [185]: arr.cumsum()</span><br><span class="line">Out[185]: array([ 0,  1,  3,  6, 10, 15, 21, 28])</span><br><span class="line">In [186]: arr = np.array([[0, 1, 2], [3, 4, 5], [6, 7, 8]])</span><br><span class="line">In [187]: arr</span><br><span class="line">Out[187]:</span><br><span class="line">array([[0, 1, 2],</span><br><span class="line">[3, 4, 5],</span><br><span class="line">[6, 7, 8]])</span><br><span class="line">#  所有元素的累积和</span><br><span class="line">In [188]: arr.cumsum(axis=0)</span><br><span class="line">Out[188]:</span><br><span class="line">array([[ 0,  1,  2],</span><br><span class="line">[ 3,  5,  7],</span><br><span class="line">[ 9, 12, 15]])</span><br></pre></td></tr></table></figure>
<p>⽤于布尔型数组的⽅法 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [190]: arr = np.random.randn(100)</span><br><span class="line">In [191]: (arr &gt; 0).sum()</span><br><span class="line">Out[191]: 42</span><br></pre></td></tr></table></figure>
<p>#####any⽤于测试数组中是否存在⼀个或多个True，⽽all则检查数组中所有值是否都是True,这两个 ⽅法也能⽤于⾮布尔型数组，所有⾮0元素将会被当做True </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">In [192]: bools = np.array([False, False, True, False])</span><br><span class="line">In [193]: bools.any()</span><br><span class="line">Out[193]: True</span><br><span class="line">In [194]: bools.all()</span><br><span class="line">Out[194]: False</span><br></pre></td></tr></table></figure>
<h5 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">In [195]: arr = np.random.randn(6)</span><br><span class="line">In [196]: arr</span><br><span class="line">Out[196]: array([ 0.6095, -0.4938,  1.24  , -0.1357,  1.43  , -0.8469])</span><br><span class="line">In [197]: arr.sort()</span><br><span class="line">In [198]: arr</span><br><span class="line">Out[198]: array([-0.8469, -0.4938, -0.1357,  0.6095,  1.24  ,  1.43  ])</span><br></pre></td></tr></table></figure>
<p>多维数组可以在任何⼀个轴向上进⾏排序 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">In [199]: arr = np.random.randn(5, 3)</span><br><span class="line">In [200]: arr</span><br><span class="line">Out[200]:</span><br><span class="line">array([[ 0.6033,  1.2636, -0.2555],</span><br><span class="line">[-0.4457,  0.4684, -0.9616],</span><br><span class="line">[-1.8245,  0.6254,  1.0229],</span><br><span class="line">[ 1.1074,  0.0909, -0.3501],</span><br><span class="line">[ 0.218 , -0.8948, -1.7415]])</span><br><span class="line">In [201]: arr.sort(1)</span><br><span class="line">In [202]: arr</span><br><span class="line">Out[202]:</span><br><span class="line">array([[-0.2555,  0.6033,  1.2636],</span><br><span class="line">[-0.9616, -0.4457,  0.4684],</span><br><span class="line">[-1.8245,  0.6254,  1.0229],</span><br><span class="line">[-0.3501,  0.0909,  1.1074],</span><br><span class="line">[-1.7415, -0.8948,  0.218 ]])</span><br></pre></td></tr></table></figure>
<h5 id="唯⼀化以及其它的集合逻辑"><a href="#唯⼀化以及其它的集合逻辑" class="headerlink" title="唯⼀化以及其它的集合逻辑"></a>唯⼀化以及其它的集合逻辑</h5><p>找出数组中的唯⼀值并返回已排序的结果 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [206]: names = np.array([&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;, &apos;Bob&apos;, &apos;Will&apos;, &apos;Joe&apos;, &apos;Joe&apos;])</span><br><span class="line">In [207]: np.unique(names)</span><br><span class="line">Out[207]:</span><br><span class="line">array([&apos;Bob&apos;, &apos;Joe&apos;, &apos;Will&apos;],</span><br><span class="line">dtype=&apos;&lt;U4&apos;)</span><br><span class="line">In [208]: ints = np.array([3, 3, 3, 2, 2, 1, 1, 4, 4])</span><br><span class="line">In [209]: np.unique(ints)</span><br><span class="line">Out[209]: array([1, 2, 3, 4])</span><br></pre></td></tr></table></figure>
<p>函数np.in1d⽤于测试⼀个数组中的值在另⼀个数组中的成员资格，返回⼀个布尔型数组 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">In [211]: values = np.array([6, 0, 0, 3, 2, 5, 6])</span><br><span class="line">In [212]: np.in1d(values, [2, 3, 6])</span><br><span class="line">Out[212]: array([ True, False, False,  True,  True, False,  True], dtype=bool)</span><br></pre></td></tr></table></figure>
<p>数组的集合运算如下：</p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析——-1/ndarray2.png" alt="ndarray2"></p>
<h4 id="⽤于数组的⽂件输⼊输出"><a href="#⽤于数组的⽂件输⼊输出" class="headerlink" title="⽤于数组的⽂件输⼊输出"></a>⽤于数组的⽂件输⼊输出</h4><p>​    NumPy的内置⼆进制格式读写 np.save和np.load是读写磁盘数组数据的两个主要函数。默认情况下，数组是以未压缩的原始 ⼆进制格式保存在扩展名为.npy的⽂件中的 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">In [213]: arr = np.arange(10)</span><br><span class="line">In [214]: np.save(&apos;some_array&apos;, arr)</span><br><span class="line">In [215]: np.load(&apos;some_array.npy&apos;)</span><br><span class="line">Out[215]: array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span><br></pre></td></tr></table></figure>
<p>通过np.savez可以将多个数组保存到⼀个未压缩⽂件中 </p>
<p>将数据压缩，可以使⽤numpy.savez_compressed </p>
<h4 id="线性代数"><a href="#线性代数" class="headerlink" title="线性代数"></a>线性代数</h4><p>矩阵乘法的dot函数 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">In [223]: x = np.array([[1., 2., 3.], [4., 5., 6.]])</span><br><span class="line">In [224]: y = np.array([[6., 23.], [-1, 7], [8, 9]])</span><br><span class="line">In [225]: x</span><br><span class="line">Out[225]:</span><br><span class="line">array([[ 1.,  2.,  3.],</span><br><span class="line">[ 4.,  5.,  6.]])</span><br><span class="line">In [226]: y</span><br><span class="line">Out[226]:</span><br><span class="line">array([[  6.,  23.],</span><br><span class="line">[ -1.,   7.],</span><br><span class="line">[  8.,   9.]])</span><br><span class="line">In [227]: x.dot(y)</span><br><span class="line">Out[227]:</span><br><span class="line">array([[  28.,   64.],</span><br><span class="line">[  67.,  181.]])</span><br></pre></td></tr></table></figure>
<p>⼀个⼆维数组跟⼀个⼤⼩合适的⼀维数组的矩阵点积运算之后将会得到⼀个⼀维数组 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [229]: np.dot(x, np.ones(3))</span><br><span class="line">Out[229]: array([  6.,  15.])</span><br></pre></td></tr></table></figure>
<p>@符也可以⽤作中缀运算符，进⾏矩阵乘法 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [230]: x @ np.ones(3)</span><br><span class="line">Out[230]: array([  6.,  15.])</span><br></pre></td></tr></table></figure>
<h4 id="伪随机数⽣成"><a href="#伪随机数⽣成" class="headerlink" title="伪随机数⽣成"></a>伪随机数⽣成</h4><p>⽤normal来得到⼀个标准正态分布的4×4样本数组 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">In [238]: samples = np.random.normal(size=(4, 4))</span><br><span class="line">In [239]: samples</span><br><span class="line">Out[239]:</span><br><span class="line">array([[ 0.5732,  0.1933,  0.4429,  1.2796],</span><br><span class="line">[ 0.575 ,  0.4339, -0.7658, -1.237 ],</span><br><span class="line">[-0.5367,  1.8545, -0.92  , -0.1082],</span><br><span class="line">[ 0.1525,  0.9435, -1.0953, -0.144 ]])</span><br></pre></td></tr></table></figure>
<p>Python内置的random模块则只能⼀次⽣成⼀个样本值。从测试结果中可以看出，如果 需要产⽣⼤量样本值，numpy.random快了不⽌⼀个数量级 </p>
<p>numpy.random的数据⽣成函数使⽤了全局的随机种⼦。要避免全局状态，你可以使⽤ numpy.random.RandomState，创建⼀个与其它隔离的随机数⽣成器 </p>
<p>部分numpy.random函数如下：</p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析——-1/ndarray3.png" alt="ndarray3"></p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析——-1/ndarray4.png" alt="ndarray4"></p>
<p>示例：</p>
<p>​    ⽤np.random模块⼀次性随机产⽣1000个“掷硬币”结果（即两个数中任选⼀个），将其分别设 置为1或－1，然后计算累计和  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">In [251]: nsteps = 1000</span><br><span class="line">In [252]: draws = np.random.randint(0, 2, size=nsteps)</span><br><span class="line">In [253]: steps = np.where(draws &gt; 0, 1, -1)</span><br><span class="line">In [254]: walk = steps.cumsum()</span><br><span class="line">In [255]: walk.min()</span><br><span class="line">Out[255]: -3</span><br><span class="line">In [256]: walk.max()</span><br><span class="line">Out[256]: 31</span><br></pre></td></tr></table></figure>
<p>我们想要知道本次随机漫步需要多久才能距离初始0点⾄少10步远（任⼀⽅向均可） </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">In [257]: (np.abs(walk) &gt;= 10).argmax()</span><br><span class="line">Out[257]: 37</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/17/Django-分页、中间键/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/17/Django-分页、中间键/" itemprop="url">Django-分页、中间键</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-17T13:59:16+08:00">
                2018-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>> 分页功能</p>
<p>ticket</p>
<p>数据库的增加</p>
<p>删除</p>
<p>修改</p>
<p>自己实现登录注册</p>
<ol>
<li>中间件Middleware</li>
</ol>
<p>中间件：</p>
<p>a) 是一个轻量级的，底层的插件，可以介入Django的请求和响应的过程（面向切面编程)</p>
<p>b) 中间件的本质就是一个python类</p>
<p>c) 面向切面编程(Aspect Oriented Programming)简称AOP，AOP的主要实现目的是针对业务处理过程中的切面进行提取，它所面对的是处理过程中的某个步骤或阶段，以获取逻辑过程中各部分之间低耦合的隔离效果</p>
<p>思考：</p>
<p>什么是中间件，在settings.py中有很多的中间件，主要是用来做什么功能的呢，他们处理请求的url的过程在那些阶段呢，一般用来做那些数据的处理呢</p>
<h5 id="1-1-中间件的处理函数"><a href="#1-1-中间件的处理函数" class="headerlink" title="1.1 中间件的处理函数"></a>1.1 中间件的处理函数</h5><pre><code>__init__：没有参数，在服务器响应的第一个请求的时候自动调用，用户确定时候启动该中间件

process_request(self, request): 在执行视图前被调用，每个请求上都会被调用，不主动进行返回或返回HttpResponse对象

process_view(self, request, view_func,view_args, view_kwargs):调用视图之前执行，每个请求都会调用，不主动进行返回或返回HttpResponse对象

process_template_response(self, request, response)：在视图刚好执行完后进行调用，每个请求都会调用，不主动进行返回或返回HttpResponse对象

process_response(self, request, response):所有响应返回浏览器之前调用，每个请求都会调用，不主动进行返回或返回HttpResponse对象

process_exception(self, request, exception):当视图抛出异常时调用，不主动进行返回或返回HttpResponse对象
</code></pre><h5 id="1-2-处理流程"><a href="#1-2-处理流程" class="headerlink" title="1.2 处理流程"></a>1.2 处理流程</h5><p><img src="/2018/08/17/Django-分页、中间键/django_middleware_liucheng.png" alt="图"></p>
<h5 id="1-3-自定义中间件流程"><a href="#1-3-自定义中间件流程" class="headerlink" title="1.3 自定义中间件流程"></a>1.3 自定义中间件流程</h5><ol>
<li>在工程目录下创建middleware目录</li>
<li>目录中创建一个python文件</li>
<li>在根据功能需求，创建切入需求类，重写切入点方法</li>
<li>from django.utils.deprecation import MiddlewareMixin</li>
</ol>
<pre><code>class AuthUserMiddleWare(MiddlewareMixin):

    def process_request(self, request):

        print(‘xxxx’)
</code></pre><ol start="5">
<li>启动中间件，在settings中进行配置，MIDDLEWARE中添加middleware.文件名.类名</li>
</ol>
<p><img src="/2018/08/17/Django-分页、中间键/django_middleware_user_auth.png" alt="图"></p>
<h4 id="2-分页"><a href="#2-分页" class="headerlink" title="2.分页"></a>2.分页</h4><h5 id="2-1-分页库Paginator的基本语法"><a href="#2-1-分页库Paginator的基本语法" class="headerlink" title="2.1 分页库Paginator的基本语法"></a>2.1 分页库Paginator的基本语法</h5><p>django提供了分页的工具，存在于django.core中</p>
<pre><code>Paginator： 数据分页工具
Page：具体的某一页
</code></pre><p>Paginator：</p>
<pre><code>对象创建： Paginator(数据集，每一页数据)
</code></pre><p>属性：</p>
<pre><code>count  计算和

num_pages: 页面总和

page_range: 页码列表，从1开始
</code></pre><p>方法：</p>
<pre><code>page(页码)：获取的一个page对象，页码不存在则抛出invalidPage的异常
</code></pre><h5 id="2-2-常见错误"><a href="#2-2-常见错误" class="headerlink" title="2.2 常见错误"></a>2.2 常见错误</h5><pre><code>invalidPage：page()传递无效页码

PageNotAnInteger：Page()传递的不是整数

Empty:page()传递的值有效，但是没有数据
</code></pre><h5 id="2-3-page对象"><a href="#2-3-page对象" class="headerlink" title="2.3 page对象"></a>2.3 page对象</h5><p>page：</p>
<pre><code>对象获取，通过Paginator的page()方法获得
</code></pre><p>属性：</p>
<pre><code>object_list: 当前页面上所有的数据对象
number： 当前页的页码值
paginator: 当前page关联的Paginator对象
</code></pre><p>方法：</p>
<pre><code>has_next()   判断是否有下一页
has_previous():  判断是否有上一页
has_other_pages():  判断是否有上一页或下一页
next_page_number();  返回下一页的页码
previous_page_number(): 返回上一页的页码
len(): 返回当前也的数据的个数
</code></pre><h5 id="2-4-Paginator对象和Page对象的关系"><a href="#2-4-Paginator对象和Page对象的关系" class="headerlink" title="2.4 Paginator对象和Page对象的关系"></a>2.4 Paginator对象和Page对象的关系</h5><p>如下有学生表，学生表中有25条数据，通过分页，每一个6条数据，去实现分页的功能</p>
<p> <img src="/2018/08/17/Django-分页、中间键/django_paginator.png" alt="图"></p>
<h5 id="2-5-代码"><a href="#2-5-代码" class="headerlink" title="2.5 代码"></a>2.5 代码</h5><p><img src="/2018/08/17/Django-分页、中间键/django_paginator_daima.png" alt="图"></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/17/Django-模型/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/17/Django-模型/" itemprop="url">Django-模型</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-17T13:57:51+08:00">
                2018-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##模型</p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>　　Django对数据库提供了很好的支持，对不同的数据库,django提供了统一调用的API，我们可以根据不同的业务需求使用不同是数据库。Django中引入了ORM(Objects Relational Mapping)对象关系映射，是一种程序技术。在下面会详细的讲解。</p>
<h4 id="修改mysql配置"><a href="#修改mysql配置" class="headerlink" title="修改mysql配置"></a>修改mysql配置</h4><h5 id="1-在settings-py中配置数据库连接信息"><a href="#1-在settings-py中配置数据库连接信息" class="headerlink" title="1. 在settings.py中配置数据库连接信息"></a>1. 在settings.py中配置数据库连接信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&apos;ENGINE&apos;:&apos;django.db.backends.mysql&apos;,</span><br><span class="line">&apos;NAME&apos;:&apos;&apos;,           #数据库名</span><br><span class="line">&apos;USER&apos;:&apos;&apos;,           #账号</span><br><span class="line">&apos;PASSWORD&apos;:&apos;&apos;,       #密码</span><br><span class="line">&apos;HOST&apos;:&apos;127.0.0.1&apos;,  #IP(本地地址也可以是localhost)</span><br><span class="line">&apos;PORT&apos;:&apos;3306&apos;,       #端口</span><br></pre></td></tr></table></figure>
<h5 id="2-mysql数据库中创建定义的数据库"><a href="#2-mysql数据库中创建定义的数据库" class="headerlink" title="2. mysql数据库中创建定义的数据库"></a>2. mysql数据库中创建定义的数据库</h5><p>a) 进入mysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure></p>
<p>b) 创建数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database xxx charset=utf-8;</span><br></pre></td></tr></table></figure></p>
<h5 id="3-配置数据库链接"><a href="#3-配置数据库链接" class="headerlink" title="3. 配置数据库链接"></a>3. 配置数据库链接</h5><p>a) 安装pymysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure></p>
<p>b) 在工程目录下的<strong>init</strong>.py文件中输入,完成数据库的驱动加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></p>
<h5 id="4-定义模型"><a href="#4-定义模型" class="headerlink" title="4. 定义模型"></a>4. 定义模型</h5><h6 id="重要概念：模型，表，属性，字段"><a href="#重要概念：模型，表，属性，字段" class="headerlink" title="重要概念：模型，表，属性，字段"></a>重要概念：模型，表，属性，字段</h6><p>一个模型类在数据库中对应一张表，在模型类中定义的属性，对应模型对照表中的一个字段</p>
<p>定义属性见定义属性文件<a href="">地址</a></p>
<h6 id="创建学生模型类"><a href="#创建学生模型类" class="headerlink" title="创建学生模型类"></a>创建学生模型类</h6><pre><code>class Student(models.Model):

    s_name = models.CharField(max_length=10)
    s_age = models.IntegerField()
    s_gender = models.BooleanField()

    class Meta:
        db_table = &apos;cd_student&apos;
        ordering =[]
    对象的默认排序字段，获取对象列表时使用，升序ordering[&apos;id&apos;]，降序ordering[&apos;-id&apos;]
</code></pre><h5 id="5-迁移数据库"><a href="#5-迁移数据库" class="headerlink" title="5.迁移数据库"></a>5.迁移数据库</h5><p>a) 生成迁移文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br></pre></td></tr></table></figure></p>
<p>注意：如果执行后并没有生成迁移文件，一直提示No changes detected这个结果的话，就要手动的去处理了。有两点处理方式：</p>
<p>1） 先删除掉<strong>pycache</strong>文件夹</p>
<p>2） 直接强制的去执行迁移命令，python manage.py makemigrations xxx (xxx就是app的名称)</p>
<p>3） 查看自动生成的数据库，查看表django_migrations，删掉app字段为xxx的数据(xxx就是app的名称)</p>
<p>b) 执行迁移生成数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure></p>
<p>注意: 生成迁移文件的时候，并没有在数据库中生成对应的表，而是执行migrate命令之后才会在数据库中生成表</p>
<h5 id="6-ORM"><a href="#6-ORM" class="headerlink" title="6. ORM"></a>6. ORM</h5><p>ORM(Objects Relational Mapping)对象关系映射，是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。可以简单理解为翻译机。</p>
<p><img src="/2018/08/17/Django-模型/django_models.jpg" alt="图"></p>
<h5 id="7-模型查询"><a href="#7-模型查询" class="headerlink" title="7.模型查询"></a>7.模型查询</h5><h6 id="a-模型成员objects"><a href="#a-模型成员objects" class="headerlink" title="a) 模型成员objects"></a>a) 模型成员objects</h6><p>Django默认通过模型的objects对象实现模型数据查询</p>
<h6 id="b-过滤器"><a href="#b-过滤器" class="headerlink" title="b) 过滤器"></a>b) 过滤器</h6><p>查询集表示从数据库获取的对象集合</p>
<p>查询集可以有多个过滤器</p>
<p>过滤器就是一个函数，基于所给的参数限制查询的结果</p>
<pre><code>从SQL角度来说，查询集合和select语句等价，过滤器就像where条件

Django有两种过滤器用于筛选记录

    filter      : 返回符合筛选条件的数据集

    exclude   : 返回不符合筛选条件的数据集
</code></pre><p>多个filter和exclude可以连接在一起查询</p>
<p>当然还有如下这些过滤器:</p>
<pre><code>all()            返回所有数据

filter()     返回符合条件的数据

exclude()        过滤掉符合条件的数据

order_by()       排序

values()         一条数据就是一个字典，返回一个列表
</code></pre><h6 id="c-查询单个数据"><a href="#c-查询单个数据" class="headerlink" title="c) 查询单个数据"></a>c) 查询单个数据</h6><p>get()：返回一个满足条件的对象。如果没有返回符合条件的对象，会应该模型类DoesNotExist异常，如果找到多个，会引发模型类MultiObjectsReturned异常</p>
<p>first()：返回查询集中的第一个对象</p>
<p>last()：返回查询集中的最后一个对象</p>
<p>count()：返回当前查询集中的对象个数</p>
<p>exists()：判断查询集中是否有数据，如果有数据返回True，没有返回False</p>
<h6 id="d-限制查询集"><a href="#d-限制查询集" class="headerlink" title="d) 限制查询集"></a>d) 限制查询集</h6><p>限制查询集，可以使用下表的方法进行限制，等同于sql中的limit</p>
<p> 模型名.objects.all()[0:5] 小标不能为负数</p>
<h6 id="e-字段查询"><a href="#e-字段查询" class="headerlink" title="e) 字段查询"></a>e) 字段查询</h6><p>对sql中的where实现，作为方法，filter(),exclude()，get()的参数</p>
<p>语法：属性名称__比较运算符 = 值</p>
<p>外键：属性名_id</p>
<p>注意：like语句中使用%表示通配符。比如sql语句查询  where name like ‘%xxx%’，等同于filter(name_contains=’xxx’)</p>
<h6 id="f-比较运算符"><a href="#f-比较运算符" class="headerlink" title="f) 比较运算符"></a>f) 比较运算符</h6><p>contains：是否包含，大小写敏感</p>
<p>startswith，endswith：以values开头或者结尾，大小写敏感<br>以上的运算符前加上i(ignore)就不区分大小写了</p>
<p>isnull，isnotnull：是否为空。filter(name__isnull=True)</p>
<p>in：是否包含在范围内。filter(id__in=[1,2,3])</p>
<p>gt，gte，lt，lte：大于，大于等于，小于，小于等于。filter(age__gt=10)</p>
<p>pk：代表主键，也就是id。filter(pk=1)</p>
<h6 id="g-聚合函数"><a href="#g-聚合函数" class="headerlink" title="g) 聚合函数"></a>g) 聚合函数</h6><p>agregate()函数返回聚合函数的值</p>
<p>Avg：平均值</p>
<p>Count：数量</p>
<p>Max：最大</p>
<p>Min：最小</p>
<p>Sum：求和                     </p>
<p>例如:  Student.objects.aggregate(Max(‘age’))</p>
<h6 id="h-F对象-Q对象"><a href="#h-F对象-Q对象" class="headerlink" title="h) F对象/Q对象"></a>h) F对象/Q对象</h6><p><b>F对象:</b>可以使用模型的A属性与B属性进行比较</p>
<p>背景:在模型中有两个字段，分别表示学生成绩A与成绩B，要对成绩AB进行比较计算，就需要使用到F对象。</p>
<p>例如有如下例子1:</p>
<pre><code>班级中有女生个数字段以及男生个数字段，统计女生数大于男生数的班级可以如下操作:

grades = Grade.objects.filter(girlnum__gt=F(&apos;boynum&apos;))
</code></pre><p>F对象支持算数运算</p>
<p>grades = Grade.objects.filter(girlnum__gt=F(‘boynum’) + 10)</p>
<p>例子2：</p>
<pre><code>查询python班下语文成绩超过数学成绩10分的学生

    grade = Grade.objects.filter(g_name=&apos;python&apos;).first()
    students = grade.student_set.all()

    stu = students.filter(s_yuwen__gt= F(&apos;s_shuxue&apos;) + 10)
</code></pre><p><b>Q对象:</b></p>
<p>Q()对象就是为了将过滤条件组合起来</p>
<p>当我们在查询的条件中需要组合条件时(例如两个条件“且”或者“或”)时。我们可以使用Q()查询对象</p>
<p>使用符号&amp;或者|将多个Q()对象组合起来传递给filter()，exclude()，get()等函数</p>
<p>Q()对象的前面使用字符“~”来代表意义“非”</p>
<p>例子1:</p>
<p>查询学生中不是12岁的或者姓名叫张三的学生</p>
<pre><code>student = Student.objects.filter(~Q(age=12) | Q(name=&apos;张三&apos;))
</code></pre><p>例子2：</p>
<p>查询python班语文小于80并且数学小于等于80的学生</p>
<pre><code>grade = Grade.objects.filter(g_name=&apos;python&apos;).first()
students = grade.student_set.all()
stu = students.filter(~Q(s_yuwen__gte=80) &amp; Q(s_shuxue__lte=80))
</code></pre><p>​<br>例子3：</p>
<p>查询python班语文大于等于80或者数学小于等于80的学生</p>
<pre><code>grade = Grade.objects.filter(g_name=&apos;python&apos;).first()
students = grade.student_set.all()

stu = students.filter(Q(s_yuwen__gte=80) | Q(s_shuxue__lte=80))
</code></pre><h5 id="8-模型字段定义属性"><a href="#8-模型字段定义属性" class="headerlink" title="8.模型字段定义属性"></a>8.模型字段定义属性</h5><p>定义属性</p>
<pre><code>概述
    ·django根据属性的类型确定以下信息
        ·当前选择的数据库支持字段的类型
        ·渲染管理表单时使用的默认html控件
        ·在管理站点最低限度的验证

    ·django会为表增加自动增长的主键列，每个模型只能有一个主键列，如果使用选项设置某属性为主键列后，则django不会再生成默认的主键列

    ·属性命名限制
        ·遵循标识符规则(不使用python预定义的标识符号，内置函数名，异常等。避免使用下划线等)
        ·由于django的查询方式，不允许使用连续的下划线



库
    ·定义属性时，需要字段类型，字段类型被定义在django.db.models.fields目录下，为了方便使用，被导入到django.db.models中

    ·使用方式
        ·导入from django.db import models
        ·通过models.Field创建字段类型的对象，赋值给属性


逻辑删除
    ·对于重要数据都做逻辑删除，不做物理删除，实现方法是定义isDelete属性，类型为BooleanField，默认值为False


字段类型
    ·AutoField
        ·一个根据实际ID自动增长的IntegerField，通常不指定如果不指定，一个主键字段将自动添加到模型中

    ·CharField(max_length=字符长度)
        ·字符串，默认的表单样式是 TextInput

    ·TextField
        ·大文本字段，一般超过4000使用，默认的表单控件是Textarea

    ·IntegerField
        ·整数

    ·DecimalField(max_digits=None, decimal_places=None)
        ·使用python的Decimal实例表示的十进制浮点数
        ·参数说明
            ·DecimalField.max_digits
                ·位数总数
            ·DecimalField.decimal_places
                ·小数点后的数字位数

    ·FloatField
        ·用Python的float实例来表示的浮点数

    ·BooleanField
        ·true/false 字段，此字段的默认表单控制是CheckboxInput

    ·NullBooleanField
        ·支持null、true、false三种值

    ·DateField([auto_now=False, auto_now_add=False])
        ·使用Python的datetime.date实例表示的日期
        ·参数说明
            ·DateField.auto_now
                ·每次保存对象时，自动设置该字段为当前时间，用于&quot;最后一次修改&quot;的时间戳，它总是使用当前日期，默认为false
            ·DateField.auto_now_add
                ·当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为false
        ·说明
            ·该字段默认对应的表单控件是一个TextInput. 在管理员站点添加了一个JavaScript写的日历控件，和一个“Today&quot;的快捷按钮，包含了一个额外的invalid_date错误消息键
        ·注意
            ·auto_now_add, auto_now, and default 这些设置是相互排斥的，他们之间的任何组合将会发生错误的结果

    ·TimeField
        ·使用Python的datetime.time实例表示的时间，参数同DateField

    ·DateTimeField
        ·使用Python的datetime.datetime实例表示的日期和时间，参数同DateField

    ·FileField
        ·一个上传文件的字段

    ·ImageField
        ·继承了FileField的所有属性和方法，但对上传的对象进行校验，确保它是个有效的image


字段选项
    ·概述
        ·通过字段选项，可以实现对字段的约束
        ·在字段对象时通过关键字参数指定

    ·null
        ·如果为True，则该字段在数据库中是空数据，默认值是 False

    ·blank
        ·如果为True，则该字段允许为空白，默认值是 False

    ·注意
        ·null是数据库范畴的概念，blank是表单验证证范畴的

    ·db_column
        ·字段的名称，如果未指定，则使用属性的名称

    ·db_index
        ·若值为 True, 则在表中会为此字段创建索引

    ·default
        ·默认值

    ·primary_key
        ·若为 True, 则该字段会成为模型的主键字段

    ·unique
        ·如果为 True, 这个字段在表中必须有唯一值
</code></pre><h4 id="模型对应关系描述如下："><a href="#模型对应关系描述如下：" class="headerlink" title="模型对应关系描述如下："></a>模型对应关系描述如下：</h4><pre><code>1：1   一对一 OneToOneField
1：N   一对多 ForeignKey
M：N   多对多 ManyToManyField
常见的几种数据关系，django都提供了很好的支持
</code></pre><h4 id="1-一对一"><a href="#1-一对一" class="headerlink" title="1. 一对一"></a>1. 一对一</h4><h5 id="1-1-模型"><a href="#1-1-模型" class="headerlink" title="1.1 模型"></a>1.1 模型</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">创建学生的模型：</span><br><span class="line">class Student(models.Model):</span><br><span class="line">    stu_name = models.CharField(max_length=6, unique=True)</span><br><span class="line">    stu_sex = models.BooleanField(default=0)</span><br><span class="line">    stu_birth = models.DateField()</span><br><span class="line">    stu_delete = models.BooleanField(default=0)</span><br><span class="line">    stu_create_time = models.DateField(auto_now_add=True)</span><br><span class="line">    stu_operate_time = models.DateField(auto_now=True)</span><br><span class="line">    stu_tel = models.CharField(max_length=11)</span><br><span class="line">    stu_yuwen = models.DecimalField(max_digits=3, decimal_places=1, default=0)</span><br><span class="line">    stu_shuxue = models.DecimalField(max_digits=3, decimal_places=1, default=0)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table = &apos;stu&apos;</span><br><span class="line"></span><br><span class="line">创建学生拓展的模型：</span><br><span class="line">class StuInfo(models.Model):</span><br><span class="line"></span><br><span class="line">    stu_addr = models.CharField(max_length=30)</span><br><span class="line">    stu_age = models.IntegerField()</span><br><span class="line">    stu = models.OneToOneField(Student)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table = &apos;stu_info&apos;</span><br></pre></td></tr></table></figure>
<pre><code>使用models.OneToOneField()进行关联
class StuInfo(models.Model):下是通过班级获取学生信
    stu = models.OneToOneField(Student)
注意：在数据中关联字段名称叫stu_id
</code></pre><h5 id="1-2-通过学生拓展表去获取学生信息"><a href="#1-2-通过学生拓展表去获取学生信息" class="headerlink" title="1.2 通过学生拓展表去获取学生信息"></a>1.2 通过学生拓展表去获取学生信息</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stuinfo = StuInfo.objects.all().first()</span><br><span class="line">student = stuinfo.stu</span><br></pre></td></tr></table></figure>

注意：通过拓展表去获取学生的信息的话，语法如下；
    学生拓展表的单条对象.关联字段，即可获取到学生表的数据
</code></pre><h5 id="1-3-通过学生获取人信息1"><a href="#1-3-通过学生获取人信息1" class="headerlink" title="1.3 通过学生获取人信息1"></a>1.3 通过学生获取人信息1</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stu = Student.objects.all().first()</span><br><span class="line">stuInfo = stu.stuInfo</span><br></pre></td></tr></table></figure>

注意：通过学生获取关联表的数据的话，语法如下：
    学生对象.关联的表名，即可获取到关联表的数据
</code></pre><h5 id="1-3-1-通过学生获取人信息2"><a href="#1-3-1-通过学生获取人信息2" class="headerlink" title="1.3.1 通过学生获取人信息2"></a>1.3.1 通过学生获取人信息2</h5><pre><code>在关联字段OneToOneField中加入参数related_name=&apos;xxx&apos;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在</span><br><span class="line">stu = Student.objects.all().first()</span><br><span class="line">stuInfo = stu.xxx</span><br></pre></td></tr></table></figure>

注意：通过学生获取关联表的数据的话，语法如下：
    学生对象.关联的字段中定义的related_name参数，即可获取到关联表的数据
</code></pre><h5 id="1-4-设置对应关系的字段为保护模式"><a href="#1-4-设置对应关系的字段为保护模式" class="headerlink" title="1.4 设置对应关系的字段为保护模式 :"></a>1.4 设置对应关系的字段为保护模式 :</h5><pre><code>models.CASCADE                      默认值
models.PROTECT                    保护模式
models.SET_NULL                 置空模式
models.SET_DETAULT          置默认值
models.SET()     删除的时候吃重新动态指向一个实体访问对象元素
on_delete = models.PROTECT

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改on_delete参数</span><br><span class="line">models.OneToOneField(&apos;Student&apos;, on_delete=models.SET_NULL, null=True)</span><br></pre></td></tr></table></figure>

在删除student对象的时候，stuinfo的关联字段会设置为空null=True，如下命令去删除student的数据：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student.objects.filter(id=1).delete()</span><br></pre></td></tr></table></figure>
</code></pre><h5 id="1-5-定义on-delete-models-PROTECT"><a href="#1-5-定义on-delete-models-PROTECT" class="headerlink" title="1.5 定义on_delete=models.PROTECT"></a>1.5 定义on_delete=models.PROTECT</h5><pre><code>p =  Student.objects.all().first()
p.delete()

注意：这个时候去执行该业务逻辑的方法的时候会报错
</code></pre><hr>
<h4 id="2-一对多"><a href="#2-一对多" class="headerlink" title="2. 一对多"></a>2. 一对多</h4><h5 id="2-1-模型"><a href="#2-1-模型" class="headerlink" title="2.1 模型"></a>2.1 模型</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">定义一个班级类还有学生类，实现一对多的关系：</span><br><span class="line">先定义班级类</span><br><span class="line">Class Grade(models.Model):</span><br><span class="line">    g_name = models.CharField(max_length=16)</span><br><span class="line">    </span><br><span class="line">定义student</span><br><span class="line">    class Student:</span><br><span class="line">        s_name = models.CharField(max_length=10)</span><br><span class="line">        s_age = models.IntegerField(default=1)</span><br><span class="line">        s_grade = models.ForeignKey(Grade, on_delete=PROTECT)</span><br></pre></td></tr></table></figure>
</code></pre><p>注意：使用models.ForeignKey关联<br>    获取对象元素 grade.student_set</p>
<h5 id="2-2-获取数据"><a href="#2-2-获取数据" class="headerlink" title="2.2 获取数据"></a>2.2 获取数据</h5><p>   语法：通过一获取多的数据</p>
<p>   公式： 一的对象.多的模型_set</p>
<p>   然后在获取数据all(), get(), filter() 等等</p>
<p>   如下先通过学生去获取班级信息：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stu = Student.objects.first()</span><br><span class="line">stu.stu_grade</span><br></pre></td></tr></table></figure></p>
<p>   如下是通过班级获取学生信息：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g = Grade.objects.all().first()</span><br><span class="line">g.stugrade.all()   ---&gt; 其中stugrade是定义的related_name参数</span><br></pre></td></tr></table></figure></p>
<p>   重点：<br>    定义了related_name字段以后，只能通过related_name去反向获取数据，在也不能通过_set方法去获取数据了</p>
<h5 id="2-3-性能对比"><a href="#2-3-性能对比" class="headerlink" title="2.3 性能对比"></a>2.3 性能对比</h5><pre><code>获取班级的学生(通过一获取多)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 低性能方法：</span><br><span class="line">g = Grade.objects.all().first()</span><br><span class="line">s = Student.objects.filter(s_grade=g)</span><br><span class="line">    </span><br><span class="line">2. 高性能方法：</span><br><span class="line">g = Grate.objects.all().first()</span><br><span class="line">s = g.student_set.all()</span><br></pre></td></tr></table></figure>
</code></pre><h5 id="2-4-练习题"><a href="#2-4-练习题" class="headerlink" title="2.4 练习题"></a>2.4 练习题</h5><h6 id="2-6-获取python班下的所有学生的信息"><a href="#2-6-获取python班下的所有学生的信息" class="headerlink" title="2.6 获取python班下的所有学生的信息"></a>2.6 获取python班下的所有学生的信息</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.all()</span><br></pre></td></tr></table></figure>
<h6 id="2-7-获取python班下语文成绩大于80分的女学生"><a href="#2-7-获取python班下语文成绩大于80分的女学生" class="headerlink" title="2.7 获取python班下语文成绩大于80分的女学生"></a>2.7 获取python班下语文成绩大于80分的女学生</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.filter(stu_yuwen__gte=80)</span><br></pre></td></tr></table></figure>
<h6 id="2-8-获取python班下语文成绩超过数学成绩10分的男学生"><a href="#2-8-获取python班下语文成绩超过数学成绩10分的男学生" class="headerlink" title="2.8 获取python班下语文成绩超过数学成绩10分的男学生"></a>2.8 获取python班下语文成绩超过数学成绩10分的男学生</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.filter(stu_yuwen__gte=F(&apos;stu_shuxue&apos;) + 10)</span><br></pre></td></tr></table></figure>
<h6 id="2-9-获取出生在80后的男学生，查看他们的班级"><a href="#2-9-获取出生在80后的男学生，查看他们的班级" class="headerlink" title="2.9 获取出生在80后的男学生，查看他们的班级"></a>2.9 获取出生在80后的男学生，查看他们的班级</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.filter(stu_birth__gte=&apos;1980-01-01&apos;, stu_birth__lte=&apos;1990-01-01&apos;)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="3-多对多"><a href="#3-多对多" class="headerlink" title="3. 多对多"></a>3. 多对多</h4><h5 id="3-1-M-N-模型"><a href="#3-1-M-N-模型" class="headerlink" title="3.1 M:N 模型"></a>3.1 M:N 模型</h5><p>定义购物车，用户的例子实现多对多：<br>    <br><br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 创建用户模型:</span><br><span class="line">class GoodsUser(models.Model):</span><br><span class="line">    u_name = models.CharField(max_length=32)</span><br><span class="line"></span><br><span class="line">2. 创建商品模型:</span><br><span class="line">class Goods(models.Model):</span><br><span class="line">    g_name = models.CharField(max_length=32)</span><br><span class="line">    g_user = models.ManyToManyField(User)</span><br></pre></td></tr></table></figure></p>
<h5 id="3-2-多对多表结构"><a href="#3-2-多对多表结构" class="headerlink" title="3.2 多对多表结构"></a>3.2 多对多表结构</h5><pre><code>多对多关系：
1. 生成表的时候会多生成一张表（实际会有三张表）
2. 生成的表是专门用来维护关系的
3. 生成的表是使用两个外键来维护多对多的关系
4. 两个一对多的关系来实现多对多的实现　　　
5. 删除一个表的数据的话，中间关联表也要删除相关的信息
</code></pre><h5 id="3-3-练习题"><a href="#3-3-练习题" class="headerlink" title="3.3 练习题"></a>3.3 练习题</h5><h6 id="3-3-1-获取第一个用户购买了那些商品"><a href="#3-3-1-获取第一个用户购买了那些商品" class="headerlink" title="3.3.1 获取第一个用户购买了那些商品"></a>3.3.1 获取第一个用户购买了那些商品</h6><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gu = GoodsUser.objects.all().first()</span><br><span class="line">allstu = gu.goods_set.all()</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="3-3-2-获取指定商品的购买用户信息"><a href="#3-3-2-获取指定商品的购买用户信息" class="headerlink" title="3.3.2 获取指定商品的购买用户信息"></a>3.3.2 获取指定商品的购买用户信息</h6><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g = Goods.objects.filter(id=1)[0]</span><br><span class="line">g.g_user.all()</span><br></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/17/Django-配置/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/17/Django-配置/" itemprop="url">Django-配置</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-17T13:57:35+08:00">
                2018-08-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>##模型</p>
<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>　　Django对数据库提供了很好的支持，对不同的数据库,django提供了统一调用的API，我们可以根据不同的业务需求使用不同是数据库。Django中引入了ORM(Objects Relational Mapping)对象关系映射，是一种程序技术。在下面会详细的讲解。</p>
<h4 id="修改mysql配置"><a href="#修改mysql配置" class="headerlink" title="修改mysql配置"></a>修改mysql配置</h4><h5 id="1-在settings-py中配置数据库连接信息"><a href="#1-在settings-py中配置数据库连接信息" class="headerlink" title="1. 在settings.py中配置数据库连接信息"></a>1. 在settings.py中配置数据库连接信息</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&apos;ENGINE&apos;:&apos;django.db.backends.mysql&apos;,</span><br><span class="line">&apos;NAME&apos;:&apos;&apos;,           #数据库名</span><br><span class="line">&apos;USER&apos;:&apos;&apos;,           #账号</span><br><span class="line">&apos;PASSWORD&apos;:&apos;&apos;,       #密码</span><br><span class="line">&apos;HOST&apos;:&apos;127.0.0.1&apos;,  #IP(本地地址也可以是localhost)</span><br><span class="line">&apos;PORT&apos;:&apos;3306&apos;,       #端口</span><br></pre></td></tr></table></figure>
<h5 id="2-mysql数据库中创建定义的数据库"><a href="#2-mysql数据库中创建定义的数据库" class="headerlink" title="2. mysql数据库中创建定义的数据库"></a>2. mysql数据库中创建定义的数据库</h5><p>a) 进入mysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p</span><br></pre></td></tr></table></figure></p>
<p>b) 创建数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database xxx charset=utf-8;</span><br></pre></td></tr></table></figure></p>
<h5 id="3-配置数据库链接"><a href="#3-配置数据库链接" class="headerlink" title="3. 配置数据库链接"></a>3. 配置数据库链接</h5><p>a) 安装pymysql<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymysql</span><br></pre></td></tr></table></figure></p>
<p>b) 在工程目录下的<strong>init</strong>.py文件中输入,完成数据库的驱动加载<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br></pre></td></tr></table></figure></p>
<h5 id="4-定义模型"><a href="#4-定义模型" class="headerlink" title="4. 定义模型"></a>4. 定义模型</h5><h6 id="重要概念：模型，表，属性，字段"><a href="#重要概念：模型，表，属性，字段" class="headerlink" title="重要概念：模型，表，属性，字段"></a>重要概念：模型，表，属性，字段</h6><p>一个模型类在数据库中对应一张表，在模型类中定义的属性，对应模型对照表中的一个字段</p>
<p>定义属性见定义属性文件<a href="">地址</a></p>
<h6 id="创建学生模型类"><a href="#创建学生模型类" class="headerlink" title="创建学生模型类"></a>创建学生模型类</h6><pre><code>class Student(models.Model):

    s_name = models.CharField(max_length=10)
    s_age = models.IntegerField()
    s_gender = models.BooleanField()

    class Meta:
        db_table = &apos;cd_student&apos;
        ordering =[]
    对象的默认排序字段，获取对象列表时使用，升序ordering[&apos;id&apos;]，降序ordering[&apos;-id&apos;]
</code></pre><h5 id="5-迁移数据库"><a href="#5-迁移数据库" class="headerlink" title="5.迁移数据库"></a>5.迁移数据库</h5><p>a) 生成迁移文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py makemigrations</span><br></pre></td></tr></table></figure></p>
<p>注意：如果执行后并没有生成迁移文件，一直提示No changes detected这个结果的话，就要手动的去处理了。有两点处理方式：</p>
<p>1） 先删除掉<strong>pycache</strong>文件夹</p>
<p>2） 直接强制的去执行迁移命令，python manage.py makemigrations xxx (xxx就是app的名称)</p>
<p>3） 查看自动生成的数据库，查看表django_migrations，删掉app字段为xxx的数据(xxx就是app的名称)</p>
<p>b) 执行迁移生成数据库<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python manage.py migrate</span><br></pre></td></tr></table></figure></p>
<p>注意: 生成迁移文件的时候，并没有在数据库中生成对应的表，而是执行migrate命令之后才会在数据库中生成表</p>
<h5 id="6-ORM"><a href="#6-ORM" class="headerlink" title="6. ORM"></a>6. ORM</h5><p>ORM(Objects Relational Mapping)对象关系映射，是一种程序技术，用于实现面向对象编程语言里不同类型系统的数据之间的转换。可以简单理解为翻译机。</p>
<p><img src="/2018/08/17/Django-配置/django_models.jpg" alt="图"></p>
<h5 id="7-模型查询"><a href="#7-模型查询" class="headerlink" title="7.模型查询"></a>7.模型查询</h5><h6 id="a-模型成员objects"><a href="#a-模型成员objects" class="headerlink" title="a) 模型成员objects"></a>a) 模型成员objects</h6><p>Django默认通过模型的objects对象实现模型数据查询</p>
<h6 id="b-过滤器"><a href="#b-过滤器" class="headerlink" title="b) 过滤器"></a>b) 过滤器</h6><p>查询集表示从数据库获取的对象集合</p>
<p>查询集可以有多个过滤器</p>
<p>过滤器就是一个函数，基于所给的参数限制查询的结果</p>
<pre><code>从SQL角度来说，查询集合和select语句等价，过滤器就像where条件

Django有两种过滤器用于筛选记录

    filter      : 返回符合筛选条件的数据集

    exclude   : 返回不符合筛选条件的数据集
</code></pre><p>多个filter和exclude可以连接在一起查询</p>
<p>当然还有如下这些过滤器:</p>
<pre><code>all()            返回所有数据

filter()     返回符合条件的数据

exclude()        过滤掉符合条件的数据

order_by()       排序

values()         一条数据就是一个字典，返回一个列表
</code></pre><h6 id="c-查询单个数据"><a href="#c-查询单个数据" class="headerlink" title="c) 查询单个数据"></a>c) 查询单个数据</h6><p>get()：返回一个满足条件的对象。如果没有返回符合条件的对象，会应该模型类DoesNotExist异常，如果找到多个，会引发模型类MultiObjectsReturned异常</p>
<p>first()：返回查询集中的第一个对象</p>
<p>last()：返回查询集中的最后一个对象</p>
<p>count()：返回当前查询集中的对象个数</p>
<p>exists()：判断查询集中是否有数据，如果有数据返回True，没有返回False</p>
<h6 id="d-限制查询集"><a href="#d-限制查询集" class="headerlink" title="d) 限制查询集"></a>d) 限制查询集</h6><p>限制查询集，可以使用下表的方法进行限制，等同于sql中的limit</p>
<p> 模型名.objects.all()[0:5] 小标不能为负数</p>
<h6 id="e-字段查询"><a href="#e-字段查询" class="headerlink" title="e) 字段查询"></a>e) 字段查询</h6><p>对sql中的where实现，作为方法，filter(),exclude()，get()的参数</p>
<p>语法：属性名称__比较运算符 = 值</p>
<p>外键：属性名_id</p>
<p>注意：like语句中使用%表示通配符。比如sql语句查询  where name like ‘%xxx%’，等同于filter(name_contains=’xxx’)</p>
<h6 id="f-比较运算符"><a href="#f-比较运算符" class="headerlink" title="f) 比较运算符"></a>f) 比较运算符</h6><p>contains：是否包含，大小写敏感</p>
<p>startswith，endswith：以values开头或者结尾，大小写敏感<br>以上的运算符前加上i(ignore)就不区分大小写了</p>
<p>isnull，isnotnull：是否为空。filter(name__isnull=True)</p>
<p>in：是否包含在范围内。filter(id__in=[1,2,3])</p>
<p>gt，gte，lt，lte：大于，大于等于，小于，小于等于。filter(age__gt=10)</p>
<p>pk：代表主键，也就是id。filter(pk=1)</p>
<h6 id="g-聚合函数"><a href="#g-聚合函数" class="headerlink" title="g) 聚合函数"></a>g) 聚合函数</h6><p>agregate()函数返回聚合函数的值</p>
<p>Avg：平均值</p>
<p>Count：数量</p>
<p>Max：最大</p>
<p>Min：最小</p>
<p>Sum：求和                     </p>
<p>例如:  Student.objects.aggregate(Max(‘age’))</p>
<h6 id="h-F对象-Q对象"><a href="#h-F对象-Q对象" class="headerlink" title="h) F对象/Q对象"></a>h) F对象/Q对象</h6><p><b>F对象:</b>可以使用模型的A属性与B属性进行比较</p>
<p>背景:在模型中有两个字段，分别表示学生成绩A与成绩B，要对成绩AB进行比较计算，就需要使用到F对象。</p>
<p>例如有如下例子1:</p>
<pre><code>班级中有女生个数字段以及男生个数字段，统计女生数大于男生数的班级可以如下操作:

grades = Grade.objects.filter(girlnum__gt=F(&apos;boynum&apos;))
</code></pre><p>F对象支持算数运算</p>
<p>grades = Grade.objects.filter(girlnum__gt=F(‘boynum’) + 10)</p>
<p>例子2：</p>
<pre><code>查询python班下语文成绩超过数学成绩10分的学生

    grade = Grade.objects.filter(g_name=&apos;python&apos;).first()
    students = grade.student_set.all()

    stu = students.filter(s_yuwen__gt= F(&apos;s_shuxue&apos;) + 10)
</code></pre><p><b>Q对象:</b></p>
<p>Q()对象就是为了将过滤条件组合起来</p>
<p>当我们在查询的条件中需要组合条件时(例如两个条件“且”或者“或”)时。我们可以使用Q()查询对象</p>
<p>使用符号&amp;或者|将多个Q()对象组合起来传递给filter()，exclude()，get()等函数</p>
<p>Q()对象的前面使用字符“~”来代表意义“非”</p>
<p>例子1:</p>
<p>查询学生中不是12岁的或者姓名叫张三的学生</p>
<pre><code>student = Student.objects.filter(~Q(age=12) | Q(name=&apos;张三&apos;))
</code></pre><p>例子2：</p>
<p>查询python班语文小于80并且数学小于等于80的学生</p>
<pre><code>grade = Grade.objects.filter(g_name=&apos;python&apos;).first()
students = grade.student_set.all()
stu = students.filter(~Q(s_yuwen__gte=80) &amp; Q(s_shuxue__lte=80))
</code></pre><p>​<br>例子3：</p>
<p>查询python班语文大于等于80或者数学小于等于80的学生</p>
<pre><code>grade = Grade.objects.filter(g_name=&apos;python&apos;).first()
students = grade.student_set.all()

stu = students.filter(Q(s_yuwen__gte=80) | Q(s_shuxue__lte=80))
</code></pre><h5 id="8-模型字段定义属性"><a href="#8-模型字段定义属性" class="headerlink" title="8.模型字段定义属性"></a>8.模型字段定义属性</h5><p>定义属性</p>
<pre><code>概述
    ·django根据属性的类型确定以下信息
        ·当前选择的数据库支持字段的类型
        ·渲染管理表单时使用的默认html控件
        ·在管理站点最低限度的验证

    ·django会为表增加自动增长的主键列，每个模型只能有一个主键列，如果使用选项设置某属性为主键列后，则django不会再生成默认的主键列

    ·属性命名限制
        ·遵循标识符规则(不使用python预定义的标识符号，内置函数名，异常等。避免使用下划线等)
        ·由于django的查询方式，不允许使用连续的下划线



库
    ·定义属性时，需要字段类型，字段类型被定义在django.db.models.fields目录下，为了方便使用，被导入到django.db.models中

    ·使用方式
        ·导入from django.db import models
        ·通过models.Field创建字段类型的对象，赋值给属性


逻辑删除
    ·对于重要数据都做逻辑删除，不做物理删除，实现方法是定义isDelete属性，类型为BooleanField，默认值为False


字段类型
    ·AutoField
        ·一个根据实际ID自动增长的IntegerField，通常不指定如果不指定，一个主键字段将自动添加到模型中

    ·CharField(max_length=字符长度)
        ·字符串，默认的表单样式是 TextInput

    ·TextField
        ·大文本字段，一般超过4000使用，默认的表单控件是Textarea

    ·IntegerField
        ·整数

    ·DecimalField(max_digits=None, decimal_places=None)
        ·使用python的Decimal实例表示的十进制浮点数
        ·参数说明
            ·DecimalField.max_digits
                ·位数总数
            ·DecimalField.decimal_places
                ·小数点后的数字位数

    ·FloatField
        ·用Python的float实例来表示的浮点数

    ·BooleanField
        ·true/false 字段，此字段的默认表单控制是CheckboxInput

    ·NullBooleanField
        ·支持null、true、false三种值

    ·DateField([auto_now=False, auto_now_add=False])
        ·使用Python的datetime.date实例表示的日期
        ·参数说明
            ·DateField.auto_now
                ·每次保存对象时，自动设置该字段为当前时间，用于&quot;最后一次修改&quot;的时间戳，它总是使用当前日期，默认为false
            ·DateField.auto_now_add
                ·当对象第一次被创建时自动设置当前时间，用于创建的时间戳，它总是使用当前日期，默认为false
        ·说明
            ·该字段默认对应的表单控件是一个TextInput. 在管理员站点添加了一个JavaScript写的日历控件，和一个“Today&quot;的快捷按钮，包含了一个额外的invalid_date错误消息键
        ·注意
            ·auto_now_add, auto_now, and default 这些设置是相互排斥的，他们之间的任何组合将会发生错误的结果

    ·TimeField
        ·使用Python的datetime.time实例表示的时间，参数同DateField

    ·DateTimeField
        ·使用Python的datetime.datetime实例表示的日期和时间，参数同DateField

    ·FileField
        ·一个上传文件的字段

    ·ImageField
        ·继承了FileField的所有属性和方法，但对上传的对象进行校验，确保它是个有效的image


字段选项
    ·概述
        ·通过字段选项，可以实现对字段的约束
        ·在字段对象时通过关键字参数指定

    ·null
        ·如果为True，则该字段在数据库中是空数据，默认值是 False

    ·blank
        ·如果为True，则该字段允许为空白，默认值是 False

    ·注意
        ·null是数据库范畴的概念，blank是表单验证证范畴的

    ·db_column
        ·字段的名称，如果未指定，则使用属性的名称

    ·db_index
        ·若值为 True, 则在表中会为此字段创建索引

    ·default
        ·默认值

    ·primary_key
        ·若为 True, 则该字段会成为模型的主键字段

    ·unique
        ·如果为 True, 这个字段在表中必须有唯一值
</code></pre><h4 id="模型对应关系描述如下："><a href="#模型对应关系描述如下：" class="headerlink" title="模型对应关系描述如下："></a>模型对应关系描述如下：</h4><pre><code>1：1   一对一 OneToOneField
1：N   一对多 ForeignKey
M：N   多对多 ManyToManyField
常见的几种数据关系，django都提供了很好的支持
</code></pre><h4 id="1-一对一"><a href="#1-一对一" class="headerlink" title="1. 一对一"></a>1. 一对一</h4><h5 id="1-1-模型"><a href="#1-1-模型" class="headerlink" title="1.1 模型"></a>1.1 模型</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">创建学生的模型：</span><br><span class="line">class Student(models.Model):</span><br><span class="line">    stu_name = models.CharField(max_length=6, unique=True)</span><br><span class="line">    stu_sex = models.BooleanField(default=0)</span><br><span class="line">    stu_birth = models.DateField()</span><br><span class="line">    stu_delete = models.BooleanField(default=0)</span><br><span class="line">    stu_create_time = models.DateField(auto_now_add=True)</span><br><span class="line">    stu_operate_time = models.DateField(auto_now=True)</span><br><span class="line">    stu_tel = models.CharField(max_length=11)</span><br><span class="line">    stu_yuwen = models.DecimalField(max_digits=3, decimal_places=1, default=0)</span><br><span class="line">    stu_shuxue = models.DecimalField(max_digits=3, decimal_places=1, default=0)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table = &apos;stu&apos;</span><br><span class="line"></span><br><span class="line">创建学生拓展的模型：</span><br><span class="line">class StuInfo(models.Model):</span><br><span class="line"></span><br><span class="line">    stu_addr = models.CharField(max_length=30)</span><br><span class="line">    stu_age = models.IntegerField()</span><br><span class="line">    stu = models.OneToOneField(Student)</span><br><span class="line"></span><br><span class="line">    class Meta:</span><br><span class="line">        db_table = &apos;stu_info&apos;</span><br></pre></td></tr></table></figure>
<pre><code>使用models.OneToOneField()进行关联
class StuInfo(models.Model):下是通过班级获取学生信
    stu = models.OneToOneField(Student)
注意：在数据中关联字段名称叫stu_id
</code></pre><h5 id="1-2-通过学生拓展表去获取学生信息"><a href="#1-2-通过学生拓展表去获取学生信息" class="headerlink" title="1.2 通过学生拓展表去获取学生信息"></a>1.2 通过学生拓展表去获取学生信息</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stuinfo = StuInfo.objects.all().first()</span><br><span class="line">student = stuinfo.stu</span><br></pre></td></tr></table></figure>

注意：通过拓展表去获取学生的信息的话，语法如下；
    学生拓展表的单条对象.关联字段，即可获取到学生表的数据
</code></pre><h5 id="1-3-通过学生获取人信息1"><a href="#1-3-通过学生获取人信息1" class="headerlink" title="1.3 通过学生获取人信息1"></a>1.3 通过学生获取人信息1</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stu = Student.objects.all().first()</span><br><span class="line">stuInfo = stu.stuInfo</span><br></pre></td></tr></table></figure>

注意：通过学生获取关联表的数据的话，语法如下：
    学生对象.关联的表名，即可获取到关联表的数据
</code></pre><h5 id="1-3-1-通过学生获取人信息2"><a href="#1-3-1-通过学生获取人信息2" class="headerlink" title="1.3.1 通过学生获取人信息2"></a>1.3.1 通过学生获取人信息2</h5><pre><code>在关联字段OneToOneField中加入参数related_name=&apos;xxx&apos;
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在</span><br><span class="line">stu = Student.objects.all().first()</span><br><span class="line">stuInfo = stu.xxx</span><br></pre></td></tr></table></figure>

注意：通过学生获取关联表的数据的话，语法如下：
    学生对象.关联的字段中定义的related_name参数，即可获取到关联表的数据
</code></pre><h5 id="1-4-设置对应关系的字段为保护模式"><a href="#1-4-设置对应关系的字段为保护模式" class="headerlink" title="1.4 设置对应关系的字段为保护模式 :"></a>1.4 设置对应关系的字段为保护模式 :</h5><pre><code>models.CASCADE                      默认值
models.PROTECT                    保护模式
models.SET_NULL                 置空模式
models.SET_DETAULT          置默认值
models.SET()     删除的时候吃重新动态指向一个实体访问对象元素
on_delete = models.PROTECT

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">修改on_delete参数</span><br><span class="line">models.OneToOneField(&apos;Student&apos;, on_delete=models.SET_NULL, null=True)</span><br></pre></td></tr></table></figure>

在删除student对象的时候，stuinfo的关联字段会设置为空null=True，如下命令去删除student的数据：
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Student.objects.filter(id=1).delete()</span><br></pre></td></tr></table></figure>
</code></pre><h5 id="1-5-定义on-delete-models-PROTECT"><a href="#1-5-定义on-delete-models-PROTECT" class="headerlink" title="1.5 定义on_delete=models.PROTECT"></a>1.5 定义on_delete=models.PROTECT</h5><pre><code>p =  Student.objects.all().first()
p.delete()

注意：这个时候去执行该业务逻辑的方法的时候会报错
</code></pre><hr>
<h4 id="2-一对多"><a href="#2-一对多" class="headerlink" title="2. 一对多"></a>2. 一对多</h4><h5 id="2-1-模型"><a href="#2-1-模型" class="headerlink" title="2.1 模型"></a>2.1 模型</h5><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">定义一个班级类还有学生类，实现一对多的关系：</span><br><span class="line">先定义班级类</span><br><span class="line">Class Grade(models.Model):</span><br><span class="line">    g_name = models.CharField(max_length=16)</span><br><span class="line">    </span><br><span class="line">定义student</span><br><span class="line">    class Student:</span><br><span class="line">        s_name = models.CharField(max_length=10)</span><br><span class="line">        s_age = models.IntegerField(default=1)</span><br><span class="line">        s_grade = models.ForeignKey(Grade, on_delete=PROTECT)</span><br></pre></td></tr></table></figure>
</code></pre><p>注意：使用models.ForeignKey关联<br>    获取对象元素 grade.student_set</p>
<h5 id="2-2-获取数据"><a href="#2-2-获取数据" class="headerlink" title="2.2 获取数据"></a>2.2 获取数据</h5><p>   语法：通过一获取多的数据</p>
<p>   公式： 一的对象.多的模型_set</p>
<p>   然后在获取数据all(), get(), filter() 等等</p>
<p>   如下先通过学生去获取班级信息：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">stu = Student.objects.first()</span><br><span class="line">stu.stu_grade</span><br></pre></td></tr></table></figure></p>
<p>   如下是通过班级获取学生信息：<br>   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g = Grade.objects.all().first()</span><br><span class="line">g.stugrade.all()   ---&gt; 其中stugrade是定义的related_name参数</span><br></pre></td></tr></table></figure></p>
<p>   重点：<br>    定义了related_name字段以后，只能通过related_name去反向获取数据，在也不能通过_set方法去获取数据了</p>
<h5 id="2-3-性能对比"><a href="#2-3-性能对比" class="headerlink" title="2.3 性能对比"></a>2.3 性能对比</h5><pre><code>获取班级的学生(通过一获取多)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">1. 低性能方法：</span><br><span class="line">g = Grade.objects.all().first()</span><br><span class="line">s = Student.objects.filter(s_grade=g)</span><br><span class="line">    </span><br><span class="line">2. 高性能方法：</span><br><span class="line">g = Grate.objects.all().first()</span><br><span class="line">s = g.student_set.all()</span><br></pre></td></tr></table></figure>
</code></pre><h5 id="2-4-练习题"><a href="#2-4-练习题" class="headerlink" title="2.4 练习题"></a>2.4 练习题</h5><h6 id="2-6-获取python班下的所有学生的信息"><a href="#2-6-获取python班下的所有学生的信息" class="headerlink" title="2.6 获取python班下的所有学生的信息"></a>2.6 获取python班下的所有学生的信息</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.all()</span><br></pre></td></tr></table></figure>
<h6 id="2-7-获取python班下语文成绩大于80分的女学生"><a href="#2-7-获取python班下语文成绩大于80分的女学生" class="headerlink" title="2.7 获取python班下语文成绩大于80分的女学生"></a>2.7 获取python班下语文成绩大于80分的女学生</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.filter(stu_yuwen__gte=80)</span><br></pre></td></tr></table></figure>
<h6 id="2-8-获取python班下语文成绩超过数学成绩10分的男学生"><a href="#2-8-获取python班下语文成绩超过数学成绩10分的男学生" class="headerlink" title="2.8 获取python班下语文成绩超过数学成绩10分的男学生"></a>2.8 获取python班下语文成绩超过数学成绩10分的男学生</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.filter(stu_yuwen__gte=F(&apos;stu_shuxue&apos;) + 10)</span><br></pre></td></tr></table></figure>
<h6 id="2-9-获取出生在80后的男学生，查看他们的班级"><a href="#2-9-获取出生在80后的男学生，查看他们的班级" class="headerlink" title="2.9 获取出生在80后的男学生，查看他们的班级"></a>2.9 获取出生在80后的男学生，查看他们的班级</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gs = Grade.objects.filter(g_name=&apos;python&apos;)[0]</span><br><span class="line">allstu = gs.student_set.filter(stu_birth__gte=&apos;1980-01-01&apos;, stu_birth__lte=&apos;1990-01-01&apos;)</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="3-多对多"><a href="#3-多对多" class="headerlink" title="3. 多对多"></a>3. 多对多</h4><h5 id="3-1-M-N-模型"><a href="#3-1-M-N-模型" class="headerlink" title="3.1 M:N 模型"></a>3.1 M:N 模型</h5><p>定义购物车，用户的例子实现多对多：<br>    <br><br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1. 创建用户模型:</span><br><span class="line">class GoodsUser(models.Model):</span><br><span class="line">    u_name = models.CharField(max_length=32)</span><br><span class="line"></span><br><span class="line">2. 创建商品模型:</span><br><span class="line">class Goods(models.Model):</span><br><span class="line">    g_name = models.CharField(max_length=32)</span><br><span class="line">    g_user = models.ManyToManyField(User)</span><br></pre></td></tr></table></figure></p>
<h5 id="3-2-多对多表结构"><a href="#3-2-多对多表结构" class="headerlink" title="3.2 多对多表结构"></a>3.2 多对多表结构</h5><pre><code>多对多关系：
1. 生成表的时候会多生成一张表（实际会有三张表）
2. 生成的表是专门用来维护关系的
3. 生成的表是使用两个外键来维护多对多的关系
4. 两个一对多的关系来实现多对多的实现　　　
5. 删除一个表的数据的话，中间关联表也要删除相关的信息
</code></pre><h5 id="3-3-练习题"><a href="#3-3-练习题" class="headerlink" title="3.3 练习题"></a>3.3 练习题</h5><h6 id="3-3-1-获取第一个用户购买了那些商品"><a href="#3-3-1-获取第一个用户购买了那些商品" class="headerlink" title="3.3.1 获取第一个用户购买了那些商品"></a>3.3.1 获取第一个用户购买了那些商品</h6><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gu = GoodsUser.objects.all().first()</span><br><span class="line">allstu = gu.goods_set.all()</span><br></pre></td></tr></table></figure>
</code></pre><h6 id="3-3-2-获取指定商品的购买用户信息"><a href="#3-3-2-获取指定商品的购买用户信息" class="headerlink" title="3.3.2 获取指定商品的购买用户信息"></a>3.3.2 获取指定商品的购买用户信息</h6><pre><code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">g = Goods.objects.filter(id=1)[0]</span><br><span class="line">g.g_user.all()</span><br></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/15/网络爬虫7-关于进程和线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/15/网络爬虫7-关于进程和线程/" itemprop="url">网络爬虫7-关于进程和线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-15T08:52:41+08:00">
                2018-08-15
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/14/网络爬虫5-xpath的使用、json数据解析/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/14/网络爬虫5-xpath的使用、json数据解析/" itemprop="url">网络爬虫5-xpath的使用、json数据解析</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-14T19:31:21+08:00">
                2018-08-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1 xpath使用<br>    （1）属性筛选<br>        //input[@id=”kw”]<br>        //span[@class=”bg s_ipt_wr quickdelete-wrap”]<br>        通过class进行选择的时候，需要将所有的class全部写进来才可以<br>    （2）索引和层级<br>        //div[@id=”head”]/div/div[@id=”u1”]/a[2]<br>    （3）获取内容和属性<br>        //div[@id=”u1”]/a[2]/text()   获取内容<br>        //div[@id=”u1”]/a[2]/@href    获取属性<br>    （4）xpath函数<br>        选出class属性以mn开头的a<br>            //div[@id=”u1”]/a[starts-with(@class,”mn”)]<br>        选出内容以地开头的a<br>            //div[@id=”u1”]/a[starts-with(text(),”地”)]<br>        选出class属性包含av的a<br>            //div[@id=”u1”]/a[contains(@class,”av”)]<br>        选出内容包含多产的a<br>            //div[@id=”u1”]/a[contains(text(),”多产”)]<br>    代码中使用xpath，首先将文档生成对象，然后根据对象的方法找到想要的节点。可以是本地文件，也可以是网络文件<br>    xpath方法返回的是一个列表，通过下标进行取内容<br>    //<em>[@id=”u1”]/a[2]<br>    //</em>[@id=”su”]    #su   #form &gt; input[type=”hidden”]:nth-child(14)<br>2 xpath案例<br>    sc.chinaz.com  美女图片<br>    懒加载：一个网页中有100个图片。需要101次请求才能加载完毕。首先加载出现在可视区内的图片，在可视区外的图片多没有加载。在用户滚动滚动条的时候，通过js动态的去监听当前这个图片有没有出现在可视区，如果出现在可视区，再去加载这个图片<br>    前端如何实现？<img src="/2018/08/14/网络爬虫5-xpath的使用、json数据解析/xxx">  <img src4="图片地址"> 当图片出现在可视区的时候，js动态的将src2修改为src，就会加载这个图片<br>    出现的形式：<br>        src2   data-src   data-original  class=”lazy”<br>    糗事百科<br>        谷歌中的xpath只能作为参考，实际都要以代码为准<br>3 json数据解析<br>    认识json？<br>    前台 ：由用户看到的界面称之为前台<br>    后台 ：管理员负责的查看的，后台管理系统<br>    前端 ：html、css、js，在浏览器那一块工作的<br>    后端 ：服务器端的，php、java、python<br>    短信发送平台。会提供单独的接口<br>    天气接口。<br>    前端后端交互一般都是json格式。<br>    后端服务器和特定功能服务器之间的交互，后端服务器称之为前端，提供服务的称之为后端，之间交互的格式也是json格式</p>
<pre><code>&lt;note&gt;你长得真漂亮&lt;/note&gt;
&apos;note&apos;: &apos;你长得真漂亮&apos;
json语法：
（1）数据都在键值对中
（2）数据以逗号隔开
（3）{}保存对象    对应的是咱的字典
（4）[]保存数组
字符串都是以双引号括起来
json的值可以是:数字、字符串、逻辑值、数组、字典、null  

Python如何解析json？
（1）原生解析，通过字典、列表解析
    import json
    json.dumps() : 将python的字典或者列表转化为json格式字符串
        ensure_ascii = False  可以看懂中文
    json.loads() : 将json格式的字符串转化为Python的对象
    了解下面的
    json.dump() : 将python对象转化为json字符串之后直接写入到文件中
    json.load() : 将文件中的json字符串直接读到python对象中
（2）jsonpath（了解）
    jsonpath用来干什么？用来解析json数据,当解析复杂一点的json数据就要用到这个。
    obj[0][&apos;lala&apos;][&apos;goudan&apos;][2][&apos;dudu&apos;][&apos;xixi&apos;]
    http://blog.csdn.net/luxideyao/article/details/77802389
    安装：pip install lxml    pip install jsonpath
    和xpath对比
    /    $    根元素
    /    .    路径分隔符，直接子元素
    .    @    当前元素
    //    ..    任意位置开始查找
    下标xpath从1开始，jsonpath从0开始
</code></pre><p><a href="https://rate.tmall.com/list_detail_rate.htm?itemId=562099309982&amp;spuId=893336129&amp;sellerId=2616970884&amp;order=3&amp;currentPage=2" target="_blank" rel="noopener">https://rate.tmall.com/list_detail_rate.htm?itemId=562099309982&amp;spuId=893336129&amp;sellerId=2616970884&amp;order=3&amp;currentPage=2</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/08/网络爬虫2-爬虫初步/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/08/网络爬虫2-爬虫初步/" itemprop="url">网络爬虫2-爬虫初步</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-08T08:49:55+08:00">
                2018-08-08
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="网络爬虫2-爬虫初步"><a href="#网络爬虫2-爬虫初步" class="headerlink" title="网络爬虫2-爬虫初步"></a>网络爬虫2-爬虫初步</h3><blockquote>
<p>本章主要介绍初步的python爬虫方法<br>包括处理url参数，构建请求对象，模拟各种请求方式，handler处理器，opener和代理等</p>
</blockquote>
<ol>
<li><h4 id="url-lib-parse"><a href="#url-lib-parse" class="headerlink" title="url lib.parse()"></a>url lib.parse()</h4><p>主要的方法用于处理参数或者url：</p>
<ul>
<li><p>url.parse.quote()</p>
<blockquote>
<p>url中不能使用中文，使用的是url编码也可以说是百分号编码</p>
<p>url中只能有字母、数字、下划线、冒号 //  ?  =等</p>
</blockquote>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">url = &apos;https://www.baidu.com/s?ie=utf-8&amp;f=3&amp;rsv_bp=0&amp;rsv_idx=1&amp;tn=baidu&amp;wd=%E5%B0%8F%E5%8F%AF%E7%88%B1&amp;rsv_pq=96be106200031fd5&amp;rsv_t=7e37zpPVn6Se%2FFpX446ehNfmIYvVrtgj1SOOkWgO48bW4gpLGLIloR6C3%2Fk&amp;rqlang=cn&amp;rsv_enter=1&amp;rsv_sug3=11&amp;rsv_sug1=3&amp;rsv_sug7=101&amp;rsv_sug2=0&amp;prefixsug=%25E5%25B0%258F%25E5%258F%25AF%25E7%2588%25B1&amp;rsp=3&amp;inputT=3801&amp;rsv_sug4=3801&apos;</span><br><span class="line"></span><br><span class="line">string = urllib.parse.quote(url)</span><br><span class="line">string_reverse = urllib.parse.unquote(string)</span><br><span class="line"></span><br><span class="line">print(string)</span><br><span class="line">print(string_reverse)</span><br></pre></td></tr></table></figure>
<p>其中对url编码是对所有的（包括=号等都进行了编码），编码后不可访问，应该对中文参数单独进行编码；解码后可访问</p>
<ul>
<li><p>urllib.parse.urlencode（）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">url = &apos;https://www.baidu.com/s？&apos;</span><br><span class="line">data = &#123;</span><br><span class="line">    &apos;ie&apos;: &apos;utf8&apos;,</span><br><span class="line">    &apos;wd&apos;: &apos;little&apos;</span><br><span class="line">&#125;</span><br><span class="line"># 将data拼接到url后面，组成完整的url</span><br><span class="line"># 方法：遍历这个字典，拼接为制定格式</span><br><span class="line">lt = []</span><br><span class="line">for k, v in data.items():</span><br><span class="line">    value = k + &apos;=&apos; + v</span><br><span class="line">    lt.append(value)</span><br><span class="line"># 将lt用&amp;符号拼接</span><br><span class="line">query_string = &apos;&amp;&apos;.join(lt)</span><br><span class="line"># 拼接url</span><br><span class="line">url += query_string</span><br><span class="line"></span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure>
<p>以上的办法可以将data中的参数处理为url中可以携带的参数，但我们有更加简便的写法，直接使用urllib.parse.urlencode(data)方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 使用urlencode()</span><br><span class="line">query_string = urllib.parse.urlencode(data)</span><br><span class="line">url += query_string</span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>也可以用url编码工具</p>
</li>
</ol>
<ol start="2">
<li><h3 id="构建请求对象"><a href="#构建请求对象" class="headerlink" title="构建请求对象"></a>构建请求对象</h3><blockquote>
<p>不同的浏览器UA都是不同的，网站服务器根据UA给予不同的响应</p>
<p>我们需要伪装UA进行请求</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import ssl</span><br><span class="line">   </span><br><span class="line">ssl._create_default_https_context = ssl._create_unverified_context</span><br><span class="line">   </span><br><span class="line">url = &apos;http://www.baidu.com/&apos;</span><br><span class="line">   </span><br><span class="line"># 如何定制UA</span><br><span class="line"># 在这个头部不仅可以定制ua，还可以定制其他的请求头部，一般只需要定制ua</span><br><span class="line">headers = &#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36&apos;</span><br><span class="line">&#125;</span><br><span class="line">   </span><br><span class="line"># 构建请求对象</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line">   </span><br><span class="line"># 发送请求，直接打开这个请求对象即可</span><br><span class="line">response = urllib.request.urlopen(request)</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="模拟各种请求方式"><a href="#模拟各种请求方式" class="headerlink" title="模拟各种请求方式"></a>模拟各种请求方式</h3><h4 id="get"><a href="#get" class="headerlink" title="get"></a>get</h4><p>模拟发送带参数的get<br>例子：输入搜索国家，单独保存为txt文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line"># 让用户输入搜索关键字</span><br><span class="line"></span><br><span class="line">keyword = input(&apos;请输入要搜索的关键字:&apos;)</span><br><span class="line">url = &apos;https://www.baidu.com/s?&apos;</span><br><span class="line"></span><br><span class="line"># get参数</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">&apos;ie&apos;: &apos;utf8&apos;,</span><br><span class="line">&apos;wd&apos;: keyword,</span><br><span class="line">&#125;</span><br><span class="line">query_string = urllib.parse.urlencode(data)</span><br><span class="line"></span><br><span class="line">url += query_string</span><br><span class="line"></span><br><span class="line"># 向url发送请求，得到响应</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.3&apos;,</span><br><span class="line">&#125;</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"></span><br><span class="line"># 拼接文件名字</span><br><span class="line"></span><br><span class="line">filename = keyword + &apos;.html&apos;</span><br><span class="line"></span><br><span class="line"># 写入到文件中</span><br><span class="line"></span><br><span class="line">with open(filename, &apos;wb&apos;) as fp:</span><br><span class="line">fp.write(response.read())</span><br></pre></td></tr></table></figure>
<h4 id="post"><a href="#post" class="headerlink" title="post"></a>post</h4><p>例子：百度翻译<br>调用百度翻译的sug接口，进行简单翻译</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">url = &apos;http://fanyi.baidu.com/sug&apos;</span><br><span class="line"># 将表单数据写成一个字典</span><br><span class="line">formdata = &#123;</span><br><span class="line">    &apos;kw&apos;: &apos;baby&apos;</span><br><span class="line">&#125;</span><br><span class="line"># 将formdata单独处理一下</span><br><span class="line">formdata = urllib.parse.urlencode(formdata).encode(&apos;utf8&apos;)</span><br><span class="line">headers = &#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.3&apos;,</span><br><span class="line">&#125;</span><br><span class="line"># 构建请求对象</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line">response = urllib.request.urlopen(request, data=formdata)</span><br><span class="line"></span><br><span class="line">print(response.read().decode(&apos;utf8&apos;))</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ul>
<li><p>调用百度翻译的接口，获取复杂一些的翻译</p>
<blockquote>
<p>在头部中除了CA还需要发送多个头部参数，可以得到单个针对性单词的翻译，但如果需要根据单词来查询需要破解百度翻译的加密sign和token</p>
</blockquote>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line"># 加密的接口，如果想要得到，需要破解</span><br><span class="line">url = &apos;http://fanyi.baidu.com/v2transapi&apos;</span><br><span class="line"></span><br><span class="line">word = &apos;wolf&apos;</span><br><span class="line"># 表单数据</span><br><span class="line">formdata = &#123;</span><br><span class="line">    &apos;from&apos;: &apos;en&apos;,</span><br><span class="line">    &apos;to&apos;: &apos;zh&apos;,</span><br><span class="line">    &apos;query&apos;: word,</span><br><span class="line">    &apos;transtype&apos;: &apos;realtime&apos;,</span><br><span class="line">    &apos;simple_means_flag&apos;: &apos;3&apos;,</span><br><span class="line">    &apos;sign&apos;: &apos;275695.55262&apos;,</span><br><span class="line">    &apos;token&apos;: &apos;268ca3a468d99f5aac3a179efad0ab28&apos;,</span><br><span class="line">&#125;</span><br><span class="line"># 处理表单数据</span><br><span class="line">formdata = urllib.parse.urlencode(formdata).encode(&apos;utf8&apos;)</span><br><span class="line">headers = &#123;</span><br><span class="line">    # &apos;Accept&apos;: &apos;*/*&apos;,</span><br><span class="line">    # 将其注释掉，索要完整的格式</span><br><span class="line">    # &apos;Accept-Encoding&apos;: &apos;gzip, deflate&apos;,</span><br><span class="line">    # &apos;Accept-Language&apos;: &apos;zh-CN,zh;q=0.9&apos;,</span><br><span class="line">    # &apos;Connection&apos;: &apos;keep-alive&apos;,</span><br><span class="line">    # 将其注释掉，让其自动计算即可</span><br><span class="line">    # &apos;Content-Length&apos;: &apos;120&apos;,</span><br><span class="line">    # &apos;Content-Type&apos;: &apos;application/x-www-form-urlencoded; charset=UTF-8&apos;,</span><br><span class="line">       &apos;Cookie&apos;: &apos;BAIDUID=55279ECD6DDA84C66A41BA7CC1E6840E:FG=1; PSTM=1533627007; 		  BIDUPSID=6F6C332F8A0E3C9949BD5D9F884F1FFB; PSINO=3; BDRCVFR[Y1-7gJ950Fn]=jCHWiyEa0lYpAN8n1msQhPEUf; BDORZ=B490B5EBF6F3CD402E515D22BCDA1598; H_PS_PSSID=1465_26963_26432_21099_26350_26925_22157; locale=zh; to_lang_often=%5B%7B%22value%22%3A%22en%22%2C%22text%22%3A%22%u82F1%u8BED%22%7D%2C%7B%22value%22%3A%22zh%22%2C%22text%22%3A%22%u4E2D%u6587%22%7D%5D; REALTIME_TRANS_SWITCH=1; FANYI_WORD_SWITCH=1; HISTORY_SWITCH=1; SOUND_SPD_SWITCH=1; SOUND_PREFER_SWITCH=1; Hm_lvt_64ecd82404c51e03dc91cb9e8c025574=1533694190; Hm_lpvt_64ecd82404c51e03dc91cb9e8c025574=1533694190; from_lang_often=%5B%7B%22value%22%3A%22zh%22%2C%22text%22%3A%22%u4E2D%u6587%22%7D%2C%7B%22value%22%3A%22en%22%2C%22text%22%3A%22%u82F1%u8BED%22%7D%5D&apos;,</span><br><span class="line">    &apos;Host&apos;: &apos;fanyi.baidu.com&apos;,</span><br><span class="line">    &apos;Origin&apos;: &apos;http://fanyi.baidu.com&apos;,</span><br><span class="line">    &apos;Referer&apos;: &apos;http://fanyi.baidu.com/?aldtype=16047&apos;,</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36&apos;,</span><br><span class="line">    &apos;X-Requested-With&apos;: &apos;XMLHttpRequest&apos;,</span><br><span class="line">&#125;</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line">response = urllib.request.urlopen(request, data=formdata)</span><br><span class="line"></span><br><span class="line">print(response.read().decode(&apos;utf-8&apos;))</span><br></pre></td></tr></table></figure>
<ul>
<li><p>可能出现的错误有：</p>
<p> {“error”:997,”from”:”en”,”to”:”zh”,”query”:”(‘wolf’,)”}：错误原因在于你没有模拟浏览器发送请求，请求头不一样,请求头有12个参数</p>
</li>
</ul>
<blockquote>
<p>有一些请求头参数不是必须的，比如以下两个，去掉就可以了</p>
</blockquote>
</li>
</ul>
<p>​    ‘Accept-Encoding’: ‘gzip, deflate’：需要解压缩才能读取,所以直接去掉</p>
<p>​    ‘Content-Length’: ‘120’： 浏览器计算长度，去掉，让其自动计算</p>
<p>​    加密的接口，需要破解</p>
<p>​     </p>
<h4 id="ajax-get"><a href="#ajax-get" class="headerlink" title="ajax-get"></a>ajax-get</h4><p>例子：豆瓣电影排行榜</p>
<p>获取豆瓣电影排行榜请求的ajax-get的url</p>
<p>让用户输入需要第几页的数据</p>
<p>通过分析我们可以得知，在豆瓣电影排行榜的url中的参数有start&amp;limit两个，其中start是偏移量，limit是每一页显示的数量，每一页显示的睡昂是固定的10条，而偏移量start是等于（n-1）*10开始。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">url = &apos;https://movie.douban.com/j/chart/top_list?type=5&amp;interval_id=100%3A90&amp;action=&amp;&apos;</span><br><span class="line">print(&apos;每页显示10条数据&apos;)</span><br><span class="line">page = int(input(&apos;请输入页码:&apos;))</span><br><span class="line"># 根据page计算出来start和limit</span><br><span class="line">start = (page-1) * 10</span><br><span class="line">limit = 10</span><br><span class="line">data = &#123;</span><br><span class="line">	&apos;start&apos;: start,</span><br><span class="line">	&apos;limit&apos;: limit,</span><br><span class="line">&#125;</span><br><span class="line">url += urllib.parse.urlencode(data)</span><br><span class="line"></span><br><span class="line">headers = &#123;</span><br><span class="line">	&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36&apos;,</span><br><span class="line">&#125;</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(response.read().decode(&apos;utf8&apos;))</span><br></pre></td></tr></table></figure>
<h4 id="ajax-post"><a href="#ajax-post" class="headerlink" title="ajax-post"></a>ajax-post</h4><p> 在肯德基的官网上爬去城市门店的分布，其为post类型的ajax请求，我们下面模拟浏览器对官网发起请求，获取数据，而请求的url可以在下图中看到</p>
<p>例子：肯德基</p>
<p><img src="/2018/08/08/网络爬虫2-爬虫初步/kfc.png" alt="肯德基"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line"></span><br><span class="line">url = &apos;http://www.kfc.com.cn/kfccda/ashx/GetStoreList.ashx?op=cname&apos;</span><br><span class="line">city = input(&apos;请输入要搜索的城市:&apos;)</span><br><span class="line">data = &#123;</span><br><span class="line">    &apos;cname&apos;: city,</span><br><span class="line">    &apos;pid&apos;: &apos;&apos;,</span><br><span class="line">    &apos;pageIndex&apos;: &apos;1&apos;,</span><br><span class="line">    &apos;pageSize&apos;: &apos;10&apos;</span><br><span class="line">&#125;</span><br><span class="line">data = urllib.parse.urlencode(data).encode(&apos;utf8&apos;)</span><br><span class="line">headers = &#123;</span><br><span class="line">    &apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36&apos;,</span><br><span class="line">&#125;</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(request, data=data)</span><br><span class="line"></span><br><span class="line">print(response.read().decode(&apos;utf8&apos;))</span><br></pre></td></tr></table></figure></p>
<ol start="4">
<li><h3 id="URLError-HTTPEroor"><a href="#URLError-HTTPEroor" class="headerlink" title="URLError\HTTPEroor"></a>URLError\HTTPEroor</h3><p>异常处理类，属于urllib.error这个模块</p>
</li>
</ol>
<ul>
<li><p>URLError：断网或者主机不存在的时候会被触发</p>
<p> 为了使代码更加健壮，应该对可能出现异常的代码进行异常捕获，使用try,Exception进行捕获</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">url = &apos;http://www.maodan.com/&apos;</span><br><span class="line">try:</span><br><span class="line">    response = urllib.request.urlopen(url)</span><br><span class="line">except Exception as e:</span><br><span class="line">    print(e)</span><br><span class="line"></span><br><span class="line">print(&apos;不影响后面的代码&apos;)</span><br></pre></td></tr></table></figure>
<ul>
<li><p>Exception： 是官方的异常基类，可以捕获所有的异常</p>
<p>但是如果想精确捕获：需要指定具体的异常，如果指定错误当然就无法捕获了</p>
</li>
</ul>
</li>
<li><p>HTTPEroor：文件不存在<br> HTTPEroor是URLError的子类，如果多个except同时捕获，为了能够精确捕获应该把父类写在最后</p>
</li>
</ul>
<ol start="5">
<li><h3 id="复杂get"><a href="#复杂get" class="headerlink" title="复杂get"></a>复杂get</h3><p> 例子：百度贴吧</p>
<p>需求描述：输入贴吧名，输入需要爬取的气势和结束页码，以贴吧名字创建文件夹，将每一页的内容全部保存下来到第n页.html中<br> 我们需要有下载功能的函数，保存功能的函数两个函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.parse</span><br><span class="line">import os</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">	name = input(&apos;请输入要爬取的贴吧的名字:&apos;)</span><br><span class="line">	start_page = int(input(&apos;请输入要爬取的起始页码:&apos;))</span><br><span class="line">	end_page = int(input(&apos;请输入要爬取的结束页码:&apos;))</span><br><span class="line">	url = &apos;https://tieba.baidu.com/f?&apos;</span><br><span class="line"></span><br><span class="line">	for page in range(start_page, end_page + 1):</span><br><span class="line">		print(&apos;正在爬取第%s页......&apos; % page)</span><br><span class="line">		# 根据url和page拼接指定页码的url</span><br><span class="line">		request = handle_request(page, baming, url)</span><br><span class="line">		# 根据请求对象发送请求得到响应写入到指定的文件中</span><br><span class="line">		down_load(request, baming, page)</span><br><span class="line">		print(&apos;结束爬取第%s页&apos; % page)</span><br><span class="line">		time.sleep(3)</span><br><span class="line"></span><br><span class="line"># 模拟发起请求，保存数据到指定的地址 </span><br><span class="line">def down_load(request, name, page):</span><br><span class="line">	response = urllib.request.urlopen(request)</span><br><span class="line">	# 通过代码创建指定的文件夹</span><br><span class="line">	dirname = name</span><br><span class="line">	# 判断不存在的时候创建</span><br><span class="line">	if not os.path.exists(dirname):</span><br><span class="line">		os.mkdir(dirname)</span><br><span class="line">	# 文件的名字</span><br><span class="line">	filename = &apos;第%s页.html&apos; % page</span><br><span class="line">	# 得到文件的路径</span><br><span class="line">	filepath = os.path.join(dirname, filename)</span><br><span class="line">	# 将内容直接写入到filepath中</span><br><span class="line">	with open(filepath, &apos;wb&apos;) as fp:</span><br><span class="line">		fp.write(response.read())</span><br><span class="line"></span><br><span class="line"># 构建url和请求对象</span><br><span class="line">def handle_request(page, name, url):</span><br><span class="line">	pn = (page-1) * 50</span><br><span class="line">	# 拼接url</span><br><span class="line">	data = &#123;</span><br><span class="line">		&apos;kw&apos;: name,</span><br><span class="line">		&apos;ie&apos;: &apos;utf8&apos;,</span><br><span class="line">		&apos;pn&apos;: pn</span><br><span class="line">	&#125;</span><br><span class="line">	url += urllib.parse.urlencode(data)</span><br><span class="line">	# print(url)</span><br><span class="line">	headers = &#123;</span><br><span class="line">		&apos;User-Agent&apos;: &apos;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.84 Safari/537.36&apos;,</span><br><span class="line">	&#125;</span><br><span class="line">	# 构建请求对象</span><br><span class="line">	request = urllib.request.Request(url, headers=headers)</span><br><span class="line">	return request</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="Handler处理器，自定义Opener"><a href="#Handler处理器，自定义Opener" class="headerlink" title="Handler处理器，自定义Opener"></a>Handler处理器，自定义Opener</h3><p> urlopen不能自己定制头部，引入自己定制的头部</p>
<p>为了解决代理和cookie这些更加高级的功能，而引入handler代理</p>
<p>首先我们来熟悉一下这个，使用它请求一个最简单的功能，高级功能的步骤是一摸一样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line"></span><br><span class="line">url = &apos;http://www.baidu.com/&apos;</span><br><span class="line"></span><br><span class="line"># 创建handler</span><br><span class="line">handler = urllib.request.HTTPHandler()</span><br><span class="line"># 根据handler创建opener</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line"># 发送请求的时候不要使用urlopen使用opener.open发送</span><br><span class="line">response = opener.open(url)</span><br><span class="line">print(response.read().decode(&apos;utf8&apos;))</span><br></pre></td></tr></table></figure>
</li>
<li><h3 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h3><p> 访问不能过于频繁，需要休眠7-10秒左右</p>
<p> 可以设置多个代理，交替请求<br> 代理服务器：快代理，西祠代理，芝麻代理，阿布云代理等<br> 代理是需要购买，分为高匿代理，透明代理，普通代理<br> 代理有了ip和端口号就能使用<br> 验证代理是否可用，可以用程序，软件（花刺代理验证）等方式</p>
</li>
</ol>
<ul>
<li>浏览器如何设置代理<br>  设置–&gt;高级设置–&gt;代理：前去配置代理的ip和端口</li>
<li>代码中如何设置代理<br>  访问百度搜索的ip服务，可以看到ip地址已经变成了代理地址，已经在代码中使用了代理<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">  url = &apos;http://www.baidu.com/s?ie=UTF-8&amp;wd=ip&apos;</span><br><span class="line">  handler = urllib.request.ProxyHandler(proxies=&#123;&apos;http&apos;: &apos;218.60.8.98:3129&apos;&#125;)</span><br><span class="line">  opener = urllib.request.build_opener(handler)</span><br><span class="line"></span><br><span class="line">  r = opener.open(url)</span><br><span class="line"></span><br><span class="line">  with open(&apos;代理.html&apos;, &apos;wb&apos;) as fp:</span><br><span class="line">      fp.write(r.read())</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/07/mysql数据库CRUD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="karen2066">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/gg.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Karen">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/08/07/mysql数据库CRUD/" itemprop="url">mysql数据库CRUD</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-07T19:51:56+08:00">
                2018-08-07
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="mysql数据库CRUD"><a href="#mysql数据库CRUD" class="headerlink" title="mysql数据库CRUD"></a>mysql数据库CRUD</h3><p>  本文从基础开始介绍mysql数据库的增删改查等基础知识</p>
<h4 id="下载安装mysql数据库"><a href="#下载安装mysql数据库" class="headerlink" title="下载安装mysql数据库"></a>下载安装mysql数据库</h4><h4 id="启动服务"><a href="#启动服务" class="headerlink" title="启动服务"></a>启动服务</h4><ol>
<li><p>services.msg</p>
</li>
<li><p>管理——&gt;服务——&gt;启动mysql</p>
</li>
<li><p>cmd——&gt;net start mysql</p>
</li>
<li><p>偏好设置——&gt;run（Mac）</p>
</li>
</ol>
<p>####停止服务</p>
<ol>
<li>net stop mysql</li>
<li>net restart mysql(重启)<br>注：以管理员身份运行<br> 如果要卸载，需要用installer卸载，否则将会有残余以后无法再次下载使用mysql</li>
</ol>
<p>启动客户端工具：<br>    在安装社区版mysql后会自动帮我们安装一个mysql的客户端，进入的方式有两种：<br>    mysql -u root -p 进入本机数据库（注意配置路径）<br>    或者从开始菜单进入<br>showdatabases; 查看所有数据库（自带4个数据库，mysql程序相关的元数据信息，mysql自己要用的）<br>select version();查看目前使用的版本<br>? 获取帮助<br>quit/exit 退出</p>
<p>####SQL(Structured Query Language)<br>我们这里使用navicat for mysql可视化工具学习sql,sql语言是不区分大小写的</p>
<ul>
<li>DDL(数据定义语言): create/ drop/ alter</li>
<li>DML(数据操纵语言): insert/ delete/ update</li>
<li>DQL(数据查询语言): select</li>
<li>DCL(数据控制语言): grant/ revoke/ begin/ commit/ rollback</li>
</ul>
<p>####数据定义语言</p>
<p>#####如果指定的数据库存在则删除<br>    drop database if exists XXX;</p>
<p>#####创建数据库并指定默认字符集<br>    create database XXX default charset utf8;</p>
<p>#####切换到XXX数据库<br>    use XXX；</p>
<p>#####关系型数据库通过二维表来创建</p>
<p>######创建学生表,定义字段</p>
<p>######主键（primary key）-能够标识唯一一条记录的列<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_student</span><br><span class="line">(</span><br><span class="line">stuid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'学号'</span>,</span><br><span class="line">sname <span class="built_in">varchar</span>(<span class="number">10</span>) <span class="keyword">not</span> <span class="literal">null</span> <span class="keyword">comment</span> <span class="string">'姓名'</span>,</span><br><span class="line">ssex <span class="built_in">bit</span> <span class="keyword">default</span> <span class="number">1</span>,</span><br><span class="line">stel <span class="built_in">char</span>(<span class="number">11</span>),</span><br><span class="line">sbirth <span class="built_in">date</span>,</span><br><span class="line">primary <span class="keyword">key</span>(stuid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>键的类型：int, varchar, bit……<br>非空约束：not null<br>默认值约束：default<br>备注：comment<br>指定字符集：charset utf8<br>指定排序规则：collation utf8_bin (如果没有指定会默认)<br>自增长的字段：int … auto_increment</p>
<blockquote>
<p>字段的三大类数据类型：<br>数值型（包括整数小数）<br>字符串<br>时间日期型</p>
</blockquote>
<p>为表指定存储引擎，指定字符集：<br>看到表的结构：desc tb_student</p>
<p>#####修改表<br>    插入新的字段<br>    alter table tb_student add columu asddr varchar(100);<br>    删除字段<br>    alter table tb_student drop columu stel;</p>
<p>#####插入记录<br>    一次插入一条学生纪录<br>    insert into tb_student values(1001, ‘小白’, 1, ‘1999-3-08’, ‘北京’);<br>    选择性插入学生纪录，指定顺序<br>    insert into tb_student (sname, stuid) values (‘小红’, 1002)<br>    批量插入学生纪录<br>    insert into tb_student values<br>    (1001, ‘小童’, 0, ‘1995-7-02’, ‘江苏南京’),<br>    (1002, ‘小灰灰’, 1, ‘1989-3-23’, ‘上海’),<br>    (1003, ‘小白’, 1, ‘1997-8-30’,’湖南长沙’),<br>    (1004, ‘小花’, 0, ‘1995-7-08’, ‘江苏南京’),<br>    (1005, ‘小江’, 1, ‘1989-3-23’, ‘上海’),<br>    (1006, ‘小飞’, 1, ‘1997-8-30’,’湖南长沙’);</p>
<p>#####删除数据<br>    删除全表(一般不会使用)<br>    delete from tb_student;<br>    删除某一条记录<br>    delete from tb_student where stuid=1003;</p>
<p>#####更新数据<br>    没有加条件，全表所有人的生日和住址都会被改变<br>    update tb_student set sbirth=’1999-2-03’, saddr=’四川成都’;<br>    更新某一条数据(通常情况下更新和删除单条数据都是以主键作为条件)<br>    update tb_student set sbirth=’1999-2-03’, saddr=’四川成都’ where stuid=1002;</p>
<p>在sql中一个=是相等的意思，如果想要赋值前面加set</p>
<p><strong>批量更新数据</strong></p>
<ul>
<li>使用or连接</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_student set saddr=&apos;统一地址&apos; where stuid=1004 or stuid=1005 or stuid=1006;</span><br></pre></td></tr></table></figure>
<ul>
<li>使用集合</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update tb_student set addr=&apos;统一地址&apos; where stuid in (1004, 1005, 1006);</span><br></pre></td></tr></table></figure>
<h4 id="例子1"><a href="#例子1" class="headerlink" title="例子1:"></a>例子1:</h4><h5 id="创建课程表和学生表"><a href="#创建课程表和学生表" class="headerlink" title="创建课程表和学生表"></a>创建课程表和学生表</h5><p>创建数据库</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create database student default charset utf8;</span><br></pre></td></tr></table></figure>
<p>创建课程表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">create table tb_course</span><br><span class="line">(</span><br><span class="line">courseid int not null,</span><br><span class="line">cname varchar(20) not null,</span><br><span class="line">ccredit int not null,</span><br><span class="line">primary key (courseid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>插入数据</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_course(courseid, cname, ccredit) values </span><br><span class="line">(001, &apos;python程序设计&apos;, 3),</span><br><span class="line">(002, &apos;java&apos;, 2),</span><br><span class="line">(003, &apos;linux操作系统&apos;, 1),</span><br><span class="line">(004, &apos;数据库基础&apos;, 1);</span><br></pre></td></tr></table></figure>
<p>记录学生选课记录，还需要一张学生选课记录表（中间表）</p>
<h4 id="分析学生表和课程表之间的关系，ER图（实体关系图）"><a href="#分析学生表和课程表之间的关系，ER图（实体关系图）" class="headerlink" title="分析学生表和课程表之间的关系，ER图（实体关系图）"></a>分析学生表和课程表之间的关系，ER图（实体关系图）</h4><p><img src="/Users/lilamei/blog/hexo/source/_posts/数据分析————-2/ER图.png" alt="ER图"></p>
<p>专业的数据库建模工具：PowerDesigner</p>
<h4 id="外键约束"><a href="#外键约束" class="headerlink" title="外键约束"></a>外键约束</h4><p>创建一对一的人员表和身份证表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_person</span><br><span class="line">(</span><br><span class="line">personid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">pname <span class="built_in">varchar</span> (<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">pbirth <span class="built_in">date</span>,</span><br><span class="line">primary <span class="keyword">key</span> (personid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_idcard</span><br><span class="line">(</span><br><span class="line">cardid <span class="built_in">char</span>(<span class="number">18</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">cpolice <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">cexpire <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">pid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">primary <span class="keyword">key</span> (cardid)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_idcard <span class="keyword">add</span> <span class="keyword">constraint</span> fk_idcard_pid foreign <span class="keyword">key</span> (pid) <span class="keyword">references</span> tb_person (personid);</span><br></pre></td></tr></table></figure>
<p>pid 只能参照人员表的主键personid，表示二者的一对一关系</p>
<p>fk_idcard_pid:表示foreignkey在idcard这张表中的pid字段</p>
<p>外键：一个外来的主键</p>
<h4 id="参照完整性"><a href="#参照完整性" class="headerlink" title="参照完整性"></a>参照完整性</h4><p>录入数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_person (pname, pbirth) <span class="keyword">values</span></span><br><span class="line">(<span class="string">'小飞飞'</span>, <span class="string">'1992-09-01'</span>),</span><br><span class="line">(<span class="string">'小可爱'</span>, <span class="string">'1992-10-01'</span>),</span><br><span class="line">(<span class="string">'小红花'</span>. <span class="string">'1982-09-01'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_idcard <span class="keyword">values</span></span><br><span class="line">(<span class="string">'847584848373728323'</span>, <span class="string">'成都市武侯区公安局'</span>,<span class="string">'2019-09-30'</span>, <span class="number">1</span>),</span><br><span class="line">(<span class="string">'818181818282738374'</span>, <span class="string">'成都市金牛区公安局'</span>,<span class="string">'2022-09-30'</span>, <span class="number">2</span>),</span><br><span class="line">(<span class="string">'818184848373827283'</span>, <span class="string">'成都市锦江区公安局'</span>,<span class="string">'2033-01-09'</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure>
<p>外键参照另一张表，有完整性约束，必须参照另一张表的主键，没有的主键也不能添加外键</p>
<h4 id="建立一对一的关联关系"><a href="#建立一对一的关联关系" class="headerlink" title="建立一对一的关联关系"></a>建立一对一的关联关系</h4><h4 id="唯一性约束"><a href="#唯一性约束" class="headerlink" title="唯一性约束"></a>唯一性约束</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_idcard <span class="keyword">add</span> <span class="keyword">constraint</span> uk_idcard_pid <span class="keyword">unique</span>(pid);</span><br></pre></td></tr></table></figure>
<p>外键对应的记录不能重复添加，且有且仅有关联到另一张表的另一个唯一的主键，一对一的关联关系完成</p>
<p><strong>如果没有唯一性约束就是一对多的关联关系了</strong></p>
<p>且建立外键关系后，如需删除被参照的记录，需要先删除参照的记录行</p>
<p>外键列是加到多的那一边的</p>
<h4 id="建立多对多的关联关系"><a href="#建立多对多的关联关系" class="headerlink" title="建立多对多的关联关系"></a>建立多对多的关联关系</h4><p>建立第三张中间表，将两张表链起来</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table tb_sc</span><br><span class="line">(</span><br><span class="line">scid int not null auto_increment comment &apos;专门作为主键的自增字段&apos;,</span><br><span class="line">sid int not null comment &apos;学号&apos;,</span><br><span class="line">cid int not null comment &apos;课程编号&apos;,</span><br><span class="line">score float,</span><br><span class="line">primary key (scid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>关系型数据库中也可以使用复合主键，primary key (sid, cid)，或者用sid，cid，和选课时间三个键作为复合主键。但是实际开发中，不会用这样的主键，因为不可重复操作，可能导致麻烦很多，且影响你的表的范式级别。</p>
<h5 id="建立关系"><a href="#建立关系" class="headerlink" title="建立关系"></a>建立关系</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_sc <span class="keyword">add</span> <span class="keyword">constraint</span> fk_sc_sid </span><br><span class="line">foreign <span class="keyword">key</span> (<span class="keyword">sid</span>) <span class="keyword">references</span> tb_student (stuid);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_sc <span class="keyword">add</span> <span class="keyword">constraint</span> fk_sc_cid</span><br><span class="line">foreign <span class="keyword">key</span> (cid) <span class="keyword">REFERENCES</span> tb_course (courseid);</span><br></pre></td></tr></table></figure>
<h5 id="插入数据"><a href="#插入数据" class="headerlink" title="插入数据"></a>插入数据</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> tb_sc (<span class="keyword">sid</span>, cid, score) <span class="keyword">values</span></span><br><span class="line">(<span class="number">1001</span>, <span class="number">001</span>, <span class="number">89</span>),</span><br><span class="line">(<span class="number">1002</span>, <span class="number">003</span>, <span class="number">90</span>),</span><br><span class="line">(<span class="number">1003</span>, <span class="number">001</span>, <span class="number">100</span>),</span><br><span class="line">(<span class="number">1004</span>, <span class="number">004</span>, <span class="number">97</span>),</span><br><span class="line">(<span class="number">1005</span>, <span class="number">002</span>, <span class="number">65</span>),</span><br><span class="line">(<span class="number">1006</span>, <span class="number">001</span>, <span class="number">80</span>);</span><br></pre></td></tr></table></figure>
<p>通过这张中间表，学生和课程的多对多关系就建立起来了。</p>
<h4 id="例子2"><a href="#例子2" class="headerlink" title="例子2"></a>例子2</h4><p>用户订单对应表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">create table tb_user</span><br><span class="line">(</span><br><span class="line">username varchar(20) not null,</span><br><span class="line">userpass varchar(20) not null,</span><br><span class="line">nickname varchar(50) not null,</span><br><span class="line">email varchar(255),</span><br><span class="line">primary key(username)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>如果关键字作为字段名称，可以加上反引号，就可以建立起来的</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_order</span><br><span class="line">(</span><br><span class="line">orderid <span class="built_in">char</span>(<span class="number">12</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">makedata datetime <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">userid <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_order <span class="keyword">add</span> primary <span class="keyword">key</span> (orderid);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_order <span class="keyword">add</span> <span class="keyword">constraint</span> fk_order_userid</span><br><span class="line">foreign <span class="keyword">key</span> (userid) <span class="keyword">references</span> tb_user (username)</span><br><span class="line"><span class="keyword">on</span> <span class="keyword">delete</span> restrict;</span><br></pre></td></tr></table></figure>
<p>级联删除：删除用户时将所属订单全部删除</p>
<p>删除的几种情况：</p>
<p>cascade：级联删除</p>
<p>restrict：默认的情况，不让删除(一般都是这样设置)</p>
<p>set null：当删除用户时，订单中的用户id设置为空(加了非空约束，不成立)</p>
<p>删除基本不会用，只是标志为不可用了</p>
<p>及联更新：</p>
<p>允许修改的键不会设置为主键，可以修改的用户名不会设置为主键。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">on updata cascade # 一般不用</span><br></pre></td></tr></table></figure>
<p>一对多的数据关系：</p>
<p>插入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">insert into tb_user (username, userpass, nickname) values</span><br><span class="line">(&apos;xiaohua&apos;, &apos;123123&apos;, &apos;huahua&apos;),</span><br><span class="line">(&apos;xiaobai&apos;, &apos;123456&apos;, &apos;abai&apos;);</span><br><span class="line">insert into tb_order values</span><br><span class="line">(&apos;112233445566&apos;, now(), &apos;xiaohua&apos;),</span><br><span class="line">(&apos;112233445567&apos;, now(), &apos;xiaobai&apos;),</span><br><span class="line">(&apos;112233445568&apos;, now(), &apos;xiaohua&apos;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>now()方法是mysql独有的，取到系统时间日期其他数据库没有</p>
</blockquote>
<h4 id="例子3"><a href="#例子3" class="headerlink" title="例子3:"></a>例子3:</h4><p><strong>多对多的读者管理系统</strong></p>
<p>在可视化工具中建立，查看sql预览</p>
<p><strong>建读者表：</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_reader</span><br><span class="line">(</span><br><span class="line">readerid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span> auto_increment,</span><br><span class="line">rname <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">rtel <span class="built_in">char</span> (<span class="number">11</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">remail <span class="built_in">varchar</span>(<span class="number">255</span>),</span><br><span class="line">primary <span class="keyword">key</span> (readerid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>只有主键能够自增</p>
<p><strong>建书籍表：</strong></p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/mysql数据库CRUD/可视化建表.png" alt="可视化建表"></p>
<p>同等对应的sql语句为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_book </span><br><span class="line">(</span><br><span class="line">bookid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>, </span><br><span class="line">bname <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">bauthor <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">bpublisher <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">bpubdate <span class="built_in">date</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">primary <span class="keyword">key</span> (bookid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p><strong>建立外键(举个栗子)</strong></p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/mysql数据库CRUD/可视化建立外键.png" alt="可视化建立外键"></p>
<p>同等sql语句为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table tb_book add constraint fk_book_author foreign key (bauthor)  references tb_user(username) </span><br><span class="line">on delete cascade</span><br><span class="line">on update cascade;</span><br></pre></td></tr></table></figure>
<p>sql预览如图所示：</p>
<p><img src="/Users/lilamei/blog/hexo/source/_posts/mysql数据库CRUD/外键预览.png" alt="image-20180827204209018"></p>
<p>外键约束如上</p>
<h5 id="中间表：图书借阅记录表（表示多对多关系）"><a href="#中间表：图书借阅记录表（表示多对多关系）" class="headerlink" title="中间表：图书借阅记录表（表示多对多关系）"></a>中间表：图书借阅记录表（表示多对多关系）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table tb_borrow_record</span><br><span class="line">(</span><br><span class="line">recid int not null auto_increment,</span><br><span class="line">rid int not null,</span><br><span class="line">bid int not null,</span><br><span class="line">borrowdate datetime not null,</span><br><span class="line">returndate datetime,</span><br><span class="line">primary key (recid)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<h5 id="建立外键约束"><a href="#建立外键约束" class="headerlink" title="建立外键约束"></a>建立外键约束</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_borrow_record <span class="keyword">add</span> <span class="keyword">constraint</span> fk_borrow_record_rid foreign <span class="keyword">key</span> (rid) <span class="keyword">references</span> tb_reader (readerid);</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> tb_record <span class="keyword">add</span> <span class="keyword">CONSTRAINT</span> fk_record_bid </span><br><span class="line">FOREIGN <span class="keyword">key</span> (bid) <span class="keyword">references</span> tb_book (bookid);</span><br></pre></td></tr></table></figure>
<p>强制性要求还书日期大于借书日期</p>
<h5 id="建立检查约束-保证数据的有效性（域完整性）"><a href="#建立检查约束-保证数据的有效性（域完整性）" class="headerlink" title="建立检查约束:保证数据的有效性（域完整性）"></a>建立检查约束:保证数据的有效性（域完整性）</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">alter table tb_record add constraint ck_record_returndate </span><br><span class="line">check (returndate &gt; borrowdate);</span><br></pre></td></tr></table></figure>
<p>​    写了没有报错，但是没有用。在MySQL中，和SQLite不生效（外键约束也米有用）。但是在oracle和db2和SQLserver等中支持</p>
<p>​    在商业级应用中应该在程序里加这个检查，不是留给数据库检查</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/gg.png"
                alt="karen2066" />
            
              <p class="site-author-name" itemprop="name">karen2066</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">34</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">karen2066</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Gemini</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('-1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'manual') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  
  

  

  

  

</body>
</html>
